
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pairwise sequence alignment &#8212; An Introduction to Applied Bioinformatics</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sequence homology searching" href="database-searching.html" />
    <link rel="prev" title="Biological Information" href="biological-information.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">An Introduction to Applied Bioinformatics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="biological-information.html">
   Biological Information
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Pairwise sequence alignment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="database-searching.html">
   Sequence homology searching
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="machine-learning.html">
   Machine learning in bioinformatics
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/pairwise-alignment.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/pairwise-alignment.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/applied-bioinformatics/iab2/main?urlpath=tree/book/pairwise-alignment.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-a-sequence-alignment">
   What is a sequence alignment?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-first-algorithm-for-aligning-a-pair-of-sequences">
   A first algorithm for aligning a pair of sequences
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-1-create-a-blank-matrix-where-the-rows-and-columns-represent-the-positions-in-the-sequences">
     Step 1: Create a blank matrix where the rows and columns represent the positions in the sequences.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-2-add-values-to-the-cells-in-the-matrix">
     Step 2: Add values to the cells in the matrix.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-3-identify-the-longest-diagonals">
     Step 3: Identify the longest diagonals.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-4-transcribe-some-of-the-possible-alignments-that-arise-from-this-process">
     Step 4: Transcribe some of the possible alignments that arise from this process.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-this-simple-procedure-is-too-simplistic">
     Why this simple procedure is too simplistic
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differential-scoring-of-matches-and-mismatches">
   Differential scoring of matches and mismatches
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-better-approach-for-global-pairwise-alignment-using-the-needleman-wunsch-algorithm">
   A better approach for global pairwise alignment using the Needleman-Wunsch algorithm
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stepwise-needleman-wunsch-alignment">
     Stepwise Needleman-Wunsch alignment
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-1-create-blank-matrices">
       Step 1: Create blank matrices.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-2-compute-f-and-t">
       Step 2: Compute
       <span class="math notranslate nohighlight">
        \(F\)
       </span>
       and
       <span class="math notranslate nohighlight">
        \(T\)
       </span>
       .
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-3-transcribe-the-alignment">
       Step 3: Transcribe the alignment.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#automating-needleman-wunsch-alignment-with-python">
     Automating Needleman-Wunsch alignment with Python
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-note-on-computing-f-and-t">
     A note on computing
     <span class="math notranslate nohighlight">
      \(F\)
     </span>
     and
     <span class="math notranslate nohighlight">
      \(T\)
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#global-versus-local-alignment">
   Global versus local alignment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#smith-waterman-local-sequence-alignment">
   Smith-Waterman local sequence alignment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     Step 1: Create blank matrices.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     Step 2: Compute
     <span class="math notranslate nohighlight">
      \(F\)
     </span>
     and
     <span class="math notranslate nohighlight">
      \(T\)
     </span>
     .
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     Step 3: Transcribe the alignment.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#automating-smith-waterman-alignment-with-python">
     Automating Smith-Waterman alignment with Python
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differential-scoring-of-gaps">
   Differential scoring of gaps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-long-does-pairwise-sequence-alignment-take">
   How long does pairwise sequence alignment take?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparing-implementations-of-smith-waterman">
     Comparing implementations of Smith-Waterman
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyzing-smith-waterman-run-time-as-a-function-of-sequence-length">
     Analyzing Smith-Waterman run time as a function of sequence length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusions-on-the-scalability-of-pairwise-sequence-alignment-with-smith-waterman">
     Conclusions on the scalability of pairwise sequence alignment with Smith-Waterman
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#list-of-works-cited">
   List of works cited
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="pairwise-sequence-alignment">
<span id="pairwise-alignment"></span><h1>Pairwise sequence alignment<a class="headerlink" href="#pairwise-sequence-alignment" title="Permalink to this headline">¶</a></h1>
<p>One of the most fundamental problems in bioinformatics is determining how similar a pair of biological sequences are. There are many applications for this, including inferring the biological function of a new protein sequence, the source organism of an observed DNA sequence, and performing molecular phylogenetics to develop hypotheses about the relatedness of organisms. On the surface this seems like a pretty straight-forward problem, not one that would have been at the center of decades of research and the subject of one of the most cited papers in modern biology <span id="id1">[<a class="reference internal" href="#id22">AGM+90</a>]</span>. In this chapter we’ll explore why determining biological sequence similarity is harder than it might initially seem, and learn about <em>pairwise sequence alignment</em>, the standard approach for determining sequence similarity.</p>
<p>Imagine you have three protein sequences - call them <code class="docutils literal notranslate"><span class="pre">r1</span></code>and <code class="docutils literal notranslate"><span class="pre">r2</span></code> (<em>r</em> is for <em>reference</em>) and <code class="docutils literal notranslate"><span class="pre">q1</span></code> (<em>q</em> is for <em>query</em>) - and you want to know whether <code class="docutils literal notranslate"><span class="pre">q1</span></code> is more similar to <code class="docutils literal notranslate"><span class="pre">r1</span></code> or <code class="docutils literal notranslate"><span class="pre">r2</span></code>. On the surface, it seems like you could just count the number of positions where they differ (i.e., compute the <a class="reference external" href="http://en.wikipedia.org/wiki/Hamming_distance">Hamming distance</a> between them) to figure this out. Here’s what this would look like using an implementation of Hamming distance from the SciPy Python library.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell performs some configuration for this notebook. It&#39;s hidden by</span>
<span class="c1"># default because it&#39;s not relevant to the content of this chapter. You&#39;ll</span>
<span class="c1"># occasionally notice that I hide this type of information so it&#39;s not </span>
<span class="c1"># distracting.</span>

<span class="o">%</span><span class="k">pylab</span> inline

<span class="kn">from</span> <span class="nn">IPython.core</span> <span class="kn">import</span> <span class="n">page</span>
<span class="n">page</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="nb">print</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">hamming</span>
<span class="kn">import</span> <span class="nn">skbio</span>

<span class="c1"># NCBI Reference Sequence: NP_000508.1 (human hemoglobin subunit A)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">skbio</span><span class="o">.</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;MVLSPADKTNVKAAWGKVGAHAGEYGAEALERMFLSFPTTKTYFPHFDLSHGSAQVKGHGKKVADALTNAVAHVDDMPNALSALSDLHAHKLRVDPVNFKLLSHCLLVTLAAHLPAEFTPAVHASLDKFLASVSTVLTSKYR&quot;</span><span class="p">)</span>

<span class="c1"># NCBI Reference Sequence: NP_001004376.1 (chicken hemoglobin subunit A)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">skbio</span><span class="o">.</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;MVLSAADKNNVKGIFTKIAGHAEEYGAETLERMFTTYPPTKTYFPHFDLSHGSAQIKGHGKKVVAALIEAANHIDDIAGTLSKLSDLHAHKLRVDPVNFKLLGQCFLVVVAIHHPAALTPEVHASLDKFLCAVGTVLTAKYR&quot;</span><span class="p">)</span>

<span class="c1"># GenBank: QFF91579.1 (sei whale hemoglobin subunit A)</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">skbio</span><span class="o">.</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;MVLFPADKSNVKATWAKIGNHGAEYGAEALERMFMNFPSTKTYFPHFDLGHDSAQVKGHGKKVADALTKAAGHMDNLLDALSDLSDLHAHKLRVDPVNFKLLSHCLLVTLALHLPAEFTPSVHASLDKFLASVSTVLTSKYR&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MVLSPADKTNVKAAWGKVGAHAGEYGAEALERMFLSFPTTKTYFPHFDLSHGSAQVKGHGKKVADALTNAVAHVDDMPNALSALSDLHAHKLRVDPVNFKLLSHCLLVTLAAHLPAEFTPAVHASLDKFLASVSTVLTSKYR
MVLSAADKNNVKGIFTKIAGHAEEYGAETLERMFTTYPPTKTYFPHFDLSHGSAQIKGHGKKVVAALIEAANHIDDIAGTLSKLSDLHAHKLRVDPVNFKLLGQCFLVVVAIHHPAALTPEVHASLDKFLCAVGTVLTAKYR
MVLFPADKSNVKATWAKIGNHGAEYGAEALERMFMNFPSTKTYFPHFDLGHDSAQVKGHGKKVADALTKAAGHMDNLLDALSDLSDLHAHKLRVDPVNFKLLSHCLLVTLALHLPAEFTPSVHASLDKFLASVSTVLTSKYR
</pre></div>
</div>
</div>
</div>
<p>Here we stored 3 protein sequences as variables. Now we’re going to compute the hamming distance between them using the function <code class="docutils literal notranslate"><span class="pre">hamming()</span></code> to assess whether our query (“q1”) is closer to reference 1 or reference 2 based on the hamming distance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">hamming</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">q1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hamming</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">q1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.16901408450704225
0.31690140845070425
</pre></div>
</div>
</div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">q1</span></code> has a smaller distance to <code class="docutils literal notranslate"><span class="pre">r1</span></code> than it does to <code class="docutils literal notranslate"><span class="pre">r2</span></code>, so <code class="docutils literal notranslate"><span class="pre">q1</span></code> is more similar to <code class="docutils literal notranslate"><span class="pre">r1</span></code> than <code class="docutils literal notranslate"><span class="pre">r2</span></code>. The comments lines above each sequence describe the source organisms. The Hamming distances between these sequences align with our understanding of the evolutionary distances between these organisms. The whale hemoglobin has a smaller Hamming distance (i.e., it’s more similar) to the human hemoglobin sequence than to the chicken hemoglobin sequences. Whales and humans are both mammals while chickens are birds, thus whales are humans are more closely related to one another than either is to birds. If we hypothesized that whales were more closely related to humans than chickens, this finding would have supported that hypothesis. Relating sequence similarity to evolutionary history isn’t always that simple though unfortunately.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition-video admonition">
<p class="admonition-title">Video</p>
<p><a class="reference external" href="https://youtu.be/FWD0fdozHcY">This video</a> on the QIIME 2 YouTube channel presents the content in this chapter through section <a class="reference internal" href="#first-alignment-algorithm"><span class="std std-ref">A first algorithm for aligning a pair of sequences</span></a>.</p>
</div>
</div>
<p>Here we’ve assumed that only <em>substitution events</em> have occurred, meaning one DNA base was substituted with another. Let’s define <code class="docutils literal notranslate"><span class="pre">q2</span></code>, which is one base shorter than <code class="docutils literal notranslate"><span class="pre">r1</span></code>, <code class="docutils literal notranslate"><span class="pre">r2</span></code>, and <code class="docutils literal notranslate"><span class="pre">q1</span></code>. Because Hamming distance requires that input sequences are of equal length, I’m going to add a <code class="docutils literal notranslate"><span class="pre">-</span></code> character to the end of <code class="docutils literal notranslate"><span class="pre">q2</span></code>. The Hamming distance computation will score that as a single base difference.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NCBI Reference Sequence: XP_028905054.1 (platypus hemoglobin subunit A); </span>
<span class="c1"># a &quot;-&quot; character was added to the end of this sequence to make it the same</span>
<span class="c1"># length as r1 and r2, enabling us to compute Hamming distances</span>

<span class="n">q2</span> <span class="o">=</span> <span class="n">skbio</span><span class="o">.</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;MLTDAEKKEVTALWGKAAGHGEEYGAEALERLFQAFPTTKTYFSHFDLSHGSAQIKAHGKKVADALSTAAGHFDDMDSALSALSDLHAHKLRVDPVNFKLLAHCILVVLARHCPGEFTPSAHAAMDKFLSKVATVLTSKYR-&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">hamming</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">q2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hamming</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">q2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9084507042253521
0.9225352112676056
</pre></div>
</div>
</div>
</div>
<p>These distances are much larger than the ones we previously obtained! That is because there seems to have been a deletion event in this platypus hemoglobin sequence relative to the human, whale, and chicken sequences. While the distances suggest that platypus (another mammal) is more similar to the human than the chicken, the distances are so much larger than before (including the original distance between whale and chicken) that I don’t have any confidence in the distances. (In a subsequent chapter we’ll discuss evaluating the statistical significance of pairwise sequence alignments.)</p>
<p>By visually comparing the platypus sequences to the reference sequences, I have a hypothesis about which amino acid was deleted in the platypus sequence. Notice that the human and chicken sequences both begin with <code class="docutils literal notranslate"><span class="pre">MVL</span></code>, while the platypus sequence begins with <code class="docutils literal notranslate"><span class="pre">ML</span></code>. I’m going to define a new sequence that I’ll call <code class="docutils literal notranslate"><span class="pre">q2_aligned</span></code>, where I move the <code class="docutils literal notranslate"><span class="pre">-</span></code> character that I added to the end of the <code class="docutils literal notranslate"><span class="pre">q2</span></code> to the spot where I hypothesize that the deletion occurred - between the <code class="docutils literal notranslate"><span class="pre">M</span></code> and the <code class="docutils literal notranslate"><span class="pre">L</span></code> at the beginning of the sequence. My hope is that this will align the more similar sequence positions to one another throughout the rest of the protein sequences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NCBI Reference Sequence: XP_028905054.1 (platypus hemoglobin subunit A); </span>
<span class="c1"># I manually aligned this sequence to r1 and r2</span>

<span class="n">q2_aligned</span> <span class="o">=</span> <span class="n">skbio</span><span class="o">.</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;M-LTDAEKKEVTALWGKAAGHGEEYGAEALERLFQAFPTTKTYFSHFDLSHGSAQIKAHGKKVADALSTAAGHFDDMDSALSALSDLHAHKLRVDPVNFKLLAHCILVVLARHCPGEFTPSAHAAMDKFLSKVATVLTSKYR&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">hamming</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">q2_aligned</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hamming</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">q2_aligned</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2746478873239437
0.34507042253521125
</pre></div>
</div>
</div>
</div>
<p>Now when I compute the Hamming distances, they look a lot more similar to those that I computed earlier. Notice that the Hamming distance between the platypus sequence and the human sequence is larger than the Hamming distance between the human and the whale, but smaller than the Hamming distance between the platypus and the chicken. Again, this aligns with our understanding of the evolutionary history: platypi (yep, <em>platypi</em> is actually the plural form of platypus!) diverged from most other mammals very early in the history of mammals. This is a profound concept that we risk taking for granted now. Comparing organisms’ DNA, RNA, and protein sequences can serve as a molecular clock that can inform us about the relative evolutionary distances between those organisms. This technique revolutionized our understanding of the evolutionary history of life on Earth!</p>
<p>What we’ve done here is create a <strong>pairwise alignment</strong> of <code class="docutils literal notranslate"><span class="pre">r1</span></code> and <code class="docutils literal notranslate"><span class="pre">q2_aligned</span></code> and of <code class="docutils literal notranslate"><span class="pre">r2</span></code> and <code class="docutils literal notranslate"><span class="pre">q2_aligned</span></code> and then computed Hamming distances between each pair of aligned sequences. In other words, we’ve <strong>aligned</strong> positions to maximize the similarity of the two sequences, using the <code class="docutils literal notranslate"><span class="pre">-</span></code> to fill in spaces where one character is missing with respect to that location in the other sequence. We refer to <code class="docutils literal notranslate"><span class="pre">-</span></code> characters in aligned sequences as <strong>gap characters</strong>, or gaps.</p>
<p>The <em>alignment</em> of these two sequences is clear if we print them  out, one on top of the other:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q2_aligned</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MVLSPADKTNVKAAWGKVGAHAGEYGAEALERMFLSFPTTKTYFPHFDLSHGSAQVKGHGKKVADALTNAVAHVDDMPNALSALSDLHAHKLRVDPVNFKLLSHCLLVTLAAHLPAEFTPAVHASLDKFLASVSTVLTSKYR
M-LTDAEKKEVTALWGKAAGHGEEYGAEALERLFQAFPTTKTYFSHFDLSHGSAQIKAHGKKVADALSTAAGHFDDMDSALSALSDLHAHKLRVDPVNFKLLAHCILVVLARHCPGEFTPSAHAAMDKFLSKVATVLTSKYR
</pre></div>
</div>
</div>
</div>
<p>Scanning through these two sequences, we can see that they are largely identical, with the exception of one <code class="docutils literal notranslate"><span class="pre">-</span></code> character, and about 27% <em>substitutions</em> of one amino acid for another.</p>
<div class="section" id="what-is-a-sequence-alignment">
<h2>What is a sequence alignment?<a class="headerlink" href="#what-is-a-sequence-alignment" title="Permalink to this headline">¶</a></h2>
<p>Let’s now take a minute to think about sequence evolution and what a biological sequence alignment actually is. Over the course of biological evolution a DNA sequence changes, most frequently due to random errors in replication (or the copying of a DNA sequence). These replication errors are referred to as <strong>mutations</strong>. Some types of mutation events that can occur are:</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In protein coding regions of genomes, substitutions may or may not result in a change in the resulting protein. These mutations would be referred to as non-synonymous or synonymous mutations, respectively. Insertions or deletions will change the resulting protein, and the size of the insertion or deletion (i.e., the number of bases inserted or deleted) determines how impactful the mutation is on the resulting protein sequence.</p>
</div>
</div>
<ul class="simple">
<li><p><strong>substitutions</strong>, where one DNA base is replaced with another;</p></li>
<li><p><strong>insertions</strong>, where one or more contiguous DNA bases are inserted into a sequence;</p></li>
<li><p>and <strong>deletions</strong>, where one or more contiguous DNA bases are deleted from a sequence.</p></li>
</ul>
<p>(Other types of mutation events can occur, but we’re going to focus on these for now.)</p>
<p><a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a> illustrates how one ancestral DNA sequence (<a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a>a), over time, might evolve into two derived sequences (<a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a>b). When two or more sequences are derived from a single ancestral sequence, as is the case in this example, those sequences are said to be <strong>homologs</strong> of one another, or homologous sequences. On a piece of paper, make a hypothesis about which of these types of mutation events occurred where over our hypothetical evolution of these sequences.</p>
<div class="figure align-default" id="pairwise-alignment-1">
<img alt="_images/pairwise-alignment-1.png" src="_images/pairwise-alignment-1.png" />
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Sequence evolution and pairwise sequence alignment. Abbreviation key: indel: insertion or deletion event has occurred since the last common ancestor; <em>sub</em>: substitution event has occurred since the last common ancestor; <em>nc</em>: no change has occurred since the last common ancestor.</span><a class="headerlink" href="#pairwise-alignment-1" title="Permalink to this image">¶</a></p>
</div>
<p><em>The goal of pairwise sequence alignment is, given two DNA, RNA, or protein sequences, to generate a hypothesis about which sequence positions derived from a common ancestral sequence position.</em> Depending on the available data and/or the goals of the experiment, you may end up performing pairwise alignment on DNA sequences, RNA sequences, or protein sequences. In general, the same procedures (or algorithms) apply to all of these cases though there are some parameters that vary with the type of molecule that you’re working with.</p>
<p>In practice, we develop a pairwise alignment hypothesis by aligning the sequences to one another, inserting gap characters as necessary, in a way that maximizes their similarity. This is a <strong>maximum parsimony</strong> approach (an application of <a class="reference external" href="https://en.wikipedia.org/wiki/Occam%27s_razor">Occam’s razor</a>), where we assume that the simplest explanation (the one involving the fewest or most common mutation events) is the most likely.</p>
<p>In nearly all cases, the only sequences we have to work with are the modern (derived) sequences, as illustrated in <a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a>c. The ancestral sequence is not something we have access to (for example, because the organism whose genome it was present in went extinct tens or hundreds or even thousands of millions of years ago).</p>
<p><a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a>d-f illustrates three possible alignments of these two sequences. Just as the notes you made about which types of mutation events may have happened at which positions represents your <em>hypothesis</em> about the evolutionary events that took place, a sequence alignment that you might get from a computer program such as BLAST is also only a hypothesis. Which do you think is the most likely alignment of these sequences (note that there may not be a single best answer)?</p>
<p>You can think of an alignment as a table (<a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a>g), where the rows are sequences and the columns are positions in those sequences. When you have two or more aligned sequences, there will, by definition, always be the same number of columns in each row. Each column in your alignment represents a hypothesis about the evolutionary events that occurred at that position since the last ancestor of the aligned sequences (the sequence in <a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a>a in our example). The specific hypotheses represented by each column in the <a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a>d alignment are explicitly annotated in <a class="reference internal" href="#pairwise-alignment-1"><span class="std std-numref">Fig. 5</span></a>g.</p>
<p>One thing that’s worth pointing out at this point is that because we don’t know what the ancestral sequence was, when we encounter a gap in a pairwise alignment, we generally won’t know whether a deletion occurred in one sequence, or an insertion occurred in the other. For that reason, you will often see the term <strong>indel</strong> used to refer to these insertion or deletion events.</p>
<p>In the next section we’ll work through an accessible but overly simplistic method for aligning a pair of sequences. As you work through this exercise, think about why it might be too simple given what you know about biological sequences.</p>
</div>
<div class="section" id="a-first-algorithm-for-aligning-a-pair-of-sequences">
<span id="first-alignment-algorithm"></span><h2>A first algorithm for aligning a pair of sequences<a class="headerlink" href="#a-first-algorithm-for-aligning-a-pair-of-sequences" title="Permalink to this headline">¶</a></h2>
<p>Let’s define two sequences, <code class="docutils literal notranslate"><span class="pre">seq1</span></code> and <code class="docutils literal notranslate"><span class="pre">seq2</span></code> and then work through an approach for aligning them. In this section we’ll work with DNA sequences, and in subsequent sections we’ll work with protein sequences. Again, the algorithms are largely the same. Throughout this book and your own work we’ll sometimes align DNA or RNA sequences, and sometimes align protein sequences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio</span> <span class="kn">import</span> <span class="n">DNA</span>
<span class="n">seq1</span> <span class="o">=</span> <span class="n">DNA</span><span class="p">(</span><span class="s2">&quot;ACCGGTGGAACCGGTAACACCCAC&quot;</span><span class="p">)</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">DNA</span><span class="p">(</span><span class="s2">&quot;ACCGGTAACCGGTTAACACCCAC&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-1-create-a-blank-matrix-where-the-rows-and-columns-represent-the-positions-in-the-sequences">
<h3>Step 1: Create a blank matrix where the rows and columns represent the positions in the sequences.<a class="headerlink" href="#step-1-create-a-blank-matrix-where-the-rows-and-columns-represent-the-positions-in-the-sequences" title="Permalink to this headline">¶</a></h3>
<p>We’ll create this matrix and initialize it with all zeros as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq2</span><span class="p">)</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq1</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/3146586984.py:5: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  data = np.zeros(shape=(num_rows, num_cols), dtype=np.int)
</pre></div>
</div>
</div>
</div>
<p>In this chapter I’ll use a function called <code class="docutils literal notranslate"><span class="pre">show_F</span></code> to display matrices like this. (I’ll define <code class="docutils literal notranslate"><span class="pre">F</span></code> a little later, so this function name will make more sense then.)</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tabulate</span>

<span class="k">def</span> <span class="nf">show_F</span><span class="p">(</span><span class="n">h_sequence</span><span class="p">,</span> <span class="n">v_sequence</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">hide_zeros</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nonzero_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">col_headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">h_sequence</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
    <span class="n">row_headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">v_sequence</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
    <span class="n">pad_headers</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row_headers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_headers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pad_headers</span><span class="p">:</span>
        <span class="n">row_headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row_headers</span>
        <span class="n">col_headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">col_headers</span>
    <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row_headers</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">current_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">hide_zeros</span><span class="p">:</span>
                    <span class="n">current_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nonzero_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">current_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nonzero_val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">col_headers</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">  A</th><th style="text-align: right;">  C</th><th style="text-align: right;">  C</th><th style="text-align: right;">  G</th><th style="text-align: right;">  G</th><th style="text-align: right;">  T</th><th style="text-align: right;">  G</th><th style="text-align: right;">  G</th><th style="text-align: right;">  A</th><th style="text-align: right;">  A</th><th style="text-align: right;">  C</th><th style="text-align: right;">  C</th><th style="text-align: right;">  G</th><th style="text-align: right;">  G</th><th style="text-align: right;">  T</th><th style="text-align: right;">  A</th><th style="text-align: right;">  A</th><th style="text-align: right;">  C</th><th style="text-align: right;">  A</th><th style="text-align: right;">  C</th><th style="text-align: right;">  C</th><th style="text-align: right;">  C</th><th style="text-align: right;">  A</th><th style="text-align: right;">  C</th></tr>
</thead>
<tbody>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>G </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>G </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>T </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>G </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>G </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>T </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>T </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>C </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
</tbody>
</table></div></div>
</div>
</div>
<div class="section" id="step-2-add-values-to-the-cells-in-the-matrix">
<h3>Step 2: Add values to the cells in the matrix.<a class="headerlink" href="#step-2-add-values-to-the-cells-in-the-matrix" title="Permalink to this headline">¶</a></h3>
<p>Next we’ll add initial values to the cells so that if the characters at the corresponding row and column are the same, the value of the cell is changed from zero to one. We can then review the resulting matrix. For clarity, we’ll have <code class="docutils literal notranslate"><span class="pre">show_F</span></code> hide the zero values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row_number</span><span class="p">,</span> <span class="n">row_character</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seq2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col_number</span><span class="p">,</span> <span class="n">col_character</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seq1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">row_character</span> <span class="o">==</span> <span class="n">col_character</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">row_number</span><span class="p">,</span> <span class="n">col_number</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">hide_zeros</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>A  </th><th>C  </th><th>C  </th><th>G  </th><th>G  </th><th>T  </th><th>G  </th><th>G  </th><th>A  </th><th>A  </th><th>C  </th><th>C  </th><th>G  </th><th>G  </th><th>T  </th><th>A  </th><th>A  </th><th>C  </th><th>A  </th><th>C  </th><th>C  </th><th>C  </th><th>A  </th><th>C  </th></tr>
</thead>
<tbody>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
<tr><td>G </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>G </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>T </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
<tr><td>G </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>G </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>T </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>T </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>1  </td><td>   </td><td>1  </td></tr>
</tbody>
</table></div></div>
</div>
</div>
<div class="section" id="step-3-identify-the-longest-diagonals">
<h3>Step 3: Identify the longest diagonals.<a class="headerlink" href="#step-3-identify-the-longest-diagonals" title="Permalink to this headline">¶</a></h3>
<p>Next we’ll identify the longest stretches of non-zero characters, which we’ll refer to here as the <em>diagonals</em>. Diagonals indicate segments of the two sequences that are identical and uninterrupted by mismatched characters (substitution events) or indel events.</p>
<p>We can identify the longest diagonals as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a copy of our data matrix to work with, so we</span>
<span class="c1"># leave the original untouched.</span>
<span class="n">summed_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># iterate over the cells in our data matrix, starting in</span>
<span class="c1"># the second row and second column</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">summed_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">summed_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="c1"># if the value in the current cell is greater than zero</span>
        <span class="c1"># (i.e., the characters at the corresponding pair of</span>
        <span class="c1"># sequence positions are the same), add the value from the</span>
        <span class="c1"># cell that is diagonally up and to the left.</span>
        <span class="k">if</span> <span class="n">summed_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">summed_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">summed_data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">summed_data</span><span class="p">,</span> <span class="n">hide_zeros</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>A  </th><th>C  </th><th>C  </th><th>G  </th><th>G  </th><th>T  </th><th>G  </th><th>G  </th><th>A  </th><th>A  </th><th>C  </th><th>C  </th><th>G  </th><th>G  </th><th>T  </th><th>A  </th><th>A  </th><th>C  </th><th>A  </th><th>C  </th><th>C  </th><th>C  </th><th>A  </th><th>C  </th></tr>
</thead>
<tbody>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>2  </td><td>   </td><td>2  </td><td>1  </td><td>1  </td><td>   </td><td>2  </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>3  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>3  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>3  </td><td>2  </td><td>   </td><td>1  </td></tr>
<tr><td>G </td><td>   </td><td>   </td><td>   </td><td>4  </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>4  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>G </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>5  </td><td>   </td><td>1  </td><td>2  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>5  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>T </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>6  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>6  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>7  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>2  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>8  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>3  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>9  </td><td>   </td><td>2  </td><td>1  </td><td>1  </td><td>   </td><td>2  </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>3  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>4  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>3  </td><td>2  </td><td>   </td><td>1  </td></tr>
<tr><td>G </td><td>   </td><td>   </td><td>   </td><td>4  </td><td>1  </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>5  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>G </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>5  </td><td>   </td><td>1  </td><td>2  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>6  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>T </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>6  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>7  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>T </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>2  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>3  </td><td>   </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>3  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>4  </td><td>   </td><td>2  </td><td>1  </td><td>1  </td><td>   </td><td>2  </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>5  </td><td>   </td><td>   </td><td>   </td><td>2  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>2  </td><td>   </td><td>6  </td><td>1  </td><td>1  </td><td>   </td><td>3  </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>3  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>3  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>7  </td><td>2  </td><td>   </td><td>1  </td></tr>
<tr><td>C </td><td>   </td><td>1  </td><td>2  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>2  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>   </td><td>1  </td><td>2  </td><td>8  </td><td>   </td><td>1  </td></tr>
<tr><td>A </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>1  </td><td>1  </td><td>   </td><td>2  </td><td>   </td><td>   </td><td>   </td><td>9  </td><td>   </td></tr>
<tr><td>C </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>2  </td><td>1  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>2  </td><td>   </td><td>3  </td><td>1  </td><td>1  </td><td>   </td><td>10 </td></tr>
</tbody>
</table></div></div>
</div>
<p>Next, we’ll identify the length of the longest diagonal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">longest_diagonal_length</span> <span class="o">=</span> <span class="n">summed_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The longest diagonal is </span><span class="si">%d</span><span class="s2"> characters long.&quot;</span> <span class="o">%</span> <span class="n">longest_diagonal_length</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The longest diagonal is 10 characters long.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="step-4-transcribe-some-of-the-possible-alignments-that-arise-from-this-process">
<h3>Step 4: Transcribe some of the possible alignments that arise from this process.<a class="headerlink" href="#step-4-transcribe-some-of-the-possible-alignments-that-arise-from-this-process" title="Permalink to this headline">¶</a></h3>
<p>I’m going to summarize how to do this algorithmically for the moment, and we’ll come back to this in more detail later in this chapter. Briefly, what we want to do is start with the longest diagonal and trace it backwards to transcribe the alignment by writing down the characters from each of the two sequences at every row and column corresponding to the diagonal that you’re following. When we encounter a break in the diagonal, we find the next longest diagonal that starts in a cell that is up and/or to the left of the cell when the previous diagonal you were following ends. For every cell that you move straight upwards (non-diagonally), we insert a gap in the sequence on the horizontal axis of your matrix. For every cell that you move straight leftwards, you’d insert a gap in the sequence on the vertical axis of your matrix.</p>
<p>We’d also generally compute a score for an alignment to help us figure out which alignments are better than others. For now, let’s add one for every match, and subtract one for every mismatch.</p>
<p>If this step is confusing, don’t worry about it for now. We’ll be back to this in a lot more detail soon.</p>
<p>Here are two possible alignments:</p>
<p>Alignment 1 (score: 19)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ACCGGTGGAACCGG</span><span class="o">-</span><span class="n">TAACACCCAC</span>
<span class="n">ACCGGT</span><span class="o">--</span><span class="n">AACCGGTTAACACCCAC</span>
</pre></div>
</div>
<p>Alignment 2 (score: 8)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ACCGGTGGAACCGGTAACACCCAC</span>
<span class="n">ACCGGT</span><span class="o">--------</span><span class="n">TAACACCCAC</span>
</pre></div>
</div>
<div class="admonition-food-for-thought admonition">
<p class="admonition-title">Food for thought</p>
<p>Why might the first alignment be the more biologically relevant one (meaning the one that is more likely to represent that true evolutionary history of this pair of molecules)? Why might the second be the more biologically relevant one?</p>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>If you’re reading this chapter interactively, go back to where we defined <code class="docutils literal notranslate"><span class="pre">seq1</span></code> and <code class="docutils literal notranslate"><span class="pre">seq2</span></code> and re-define one or both of those as other sequences. Execute the code through here and see how the matrices change.</p>
</div>
</div>
<div class="section" id="why-this-simple-procedure-is-too-simplistic">
<h3>Why this simple procedure is too simplistic<a class="headerlink" href="#why-this-simple-procedure-is-too-simplistic" title="Permalink to this headline">¶</a></h3>
<p>I suggested above that you keep a list of assumptions that are made by this approach. Here are a couple of the very problematic ones.</p>
<ol class="simple">
<li><p>We’re scoring all matches as 1 and all mismatches as -1. This suggests that all matches are equally likely, and all mismatches are equally unlikely. What’s a more biologically meaningful way to do this (think about protein sequences here)?</p></li>
<li><p>Similarly, every gap that is introduced results in the same penalty being incurred. Based on what we know about how insertion/deletion events occur, what do you think is a more biologically meaningful way to do this?</p></li>
</ol>
<p>All scoring schemes have limitations, and you should remember that when you’re working with software that generates alignments for you (e.g., systems such as <a class="reference external" href="http://blast.ncbi.nlm.nih.gov/Blast.cgi">BLAST</a>). Especially as you’re getting started in bioinformatics, it’s easy to forget that and just accept the result from computer software as “the right answer”. You’ll need to determine if you agree with the result that a computational system gives you, which will involve examining the result in the context of what you know about the biology of the systems your studying. Algorithms such as the one we just explored are there to help you do your work, but they won’t do your work for you. Their answers are based on models (in this example, how we model matches, mismatches, and gaps) and as you’re learning here, the models are not perfect. Be skeptical of automated approaches to solve complex problems!</p>
<p>Another important consideration as we think about algorithms for aligning pairs of sequences is how long an algorithm will take to run as a function of the input it’s provided (or in technical terminology, the <a class="reference external" href="http://bigocheatsheet.com/">computational complexity</a> of the algorithm). When searching a sequence against a database (for example, to get an idea of what its function is), you may have billions of bases to search against, which would correspond to billions of columns in one of the matrices we just computed. Computers are fast, but the data sets you’re going to be working with are very large and in many cases growing exponentially in size over time. Working in bioinformatics, it’s inevitable that you’re going to begin to discover the limitations of the algorithms and software you use. Runtime and memory requirements are the usual culprits. Because the data sets are getting bigger more quickly than computers are getting faster (at least as of this writing), just waiting for computers to get faster won’t work. We need smart people who understand some computer science and some biology to design clever algorithms, software, and analytic techniques to enable the next generation of advances that technologies like high-throughput DNA sequencing are promising. (And there are a lot of people who want to spend good money to pay people who can do these things, so keep reading!)</p>
<p>Over the next several sections we’ll explore ways of addressing the two issues noted above. We’ll introduce the problem of the computational complexity of pairwise sequence alignment at the end of this chapter, and explore approaches for addressing that (i.e., making database searching faster) in the next chapter.</p>
</div>
</div>
<div class="section" id="differential-scoring-of-matches-and-mismatches">
<h2>Differential scoring of matches and mismatches<a class="headerlink" href="#differential-scoring-of-matches-and-mismatches" title="Permalink to this headline">¶</a></h2>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition-video admonition">
<p class="admonition-title">Video</p>
<p><a class="reference external" href="https://youtu.be/DpZqo32lZjU">This video</a> on the QIIME 2 YouTube channel presents the content in this chapter through section <a class="reference internal" href="#nw-alignment"><span class="std std-ref">A better approach for global pairwise alignment using the Needleman-Wunsch algorithm</span></a>.</p>
</div>
</div>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition-jargon-what-is-an-amino-acid-residue admonition">
<p class="admonition-title">Jargon: What is an “amino acid residue”?</p>
<p>When amino acids are joined to create a protein molecule, they are covalently linked to other amino acids. As a result, they can no longer technically be classified as amino acids. We therefore refer to them as residues of amino acids, or <strong>residues</strong> for short.</p>
</div>
</div>
<p>When aligning nucleotide sequences, using a simple two-value scoring scheme (where  all matches are scored with one value and all mismatches with another value) is common, but this approach is overly simplistic for protein sequences. In this section, we’re going to switch gears to talking about protein alignment. The most commonly used algorithms are the same for nucleotides and proteins, so most of the ideas that we’ll discuss here are general to both. With protein sequences, we’re aligning <strong>amino acid residues</strong> (or <strong>residues</strong>, for short) to one another, instead of nucleotides.</p>
<p>First, let’s talk about why two-value scoring schemes are too simplistic for protein alignment. In a protein, each amino acid residue is contributing to the structure and/or function of the protein. A given amino acid residue may contribute a charge to an enzyme that helps it to bind its substrate, it may introduce structural stability or instability in a protein, or provide spacing between different functional domains of the protein. Substitutions between amino acids that have similar chemical or physical properties tend to be better tolerated (i.e., less detrimental to the function of the protein) than substitutions between amino acids with different chemical or physical properties. It therefore makes sense to account for the chemical and physical properties of the amino acids being aligned when scoring matches and mismatches.</p>
<p>Let’s take the sodium-potassium pump as an example (<a class="reference internal" href="#pdb-1"><span class="std std-numref">Fig. 6</span></a>). This molecule is described in the Protein Data Bank’s (PDB) <em>Molecule of the Month</em> series. Spend a couple of minutes reading about it <a class="reference external" href="http://pdb101.rcsb.org/motm/118">here</a>.</p>
<div class="figure align-default" id="pdb-1">
<img alt="_images/pdb-1.jpg" src="_images/pdb-1.jpg" />
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">Structure of a sodium-potassium pump, as illustrated in the PDB <i>Molecule of the Month</i> series. To learn more about protein structure, a good place to start is the <a href="http://pdb101.rcsb.org/">PDB Educational Portal</a>. (Image source: <a class="reference external" href="http://cdn.rcsb.org/pdb101/motm/images/2zxe_composite.jpg">http://cdn.rcsb.org/pdb101/motm/images/2zxe_composite.jpg</a>)</span><a class="headerlink" href="#pdb-1" title="Permalink to this image">¶</a></p>
</div>
<p>Because the sodium-potassium pump is a membrane-bound protein, it has regions that are composed of long stretches of polar or charged residues, which facilitate being positioned inside or outside of the cell, and regions that are composed of long stretches of non-polar residues, which facilitate being positioned within the cell membrane. If a mutation occurs in a gene encoding a sodium-potassium pump that substitutes a non-polar residue for another non-polar residue, that will likely be less disruptive to the protein’s function than if a polar residue is substituted for a non-polar residue. This is because the non-polar residue is likely to be in the membrane-bound region of the protein (since that’s where most of the non-polar residues are in this protein), and polar residues destabilize membrane-bound proteins when they are present within the membrane (a highly non-polar environment). Given this knowledge of amino acids and proteins, when aligning a pair of protein sequences, we probably want to score the alignment of a non-polar residue with a polar residue as less likely than with another non-polar residue.</p>
<p>To score matches and mismatches differently based on which pair of amino acid residues are being aligned, our alignment algorithm is redefined to incorporate a <strong>substitution matrix</strong>, which defines the score associated with substitution of one amino acid for another. A widely used substitution matrix is referred to as BLOSUM 50. Let’s take a look at this matrix:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_substitution_matrix</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">current_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">current_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>

<span class="n">blosum50</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">},</span>
<span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">},</span>
<span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
<span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">},</span>
<span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
<span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
<span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">},</span>
<span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
<span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
<span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
<span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}}</span>

<span class="n">aas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">blosum50</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">aas</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">aa1</span> <span class="ow">in</span> <span class="n">aas</span><span class="p">:</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">aa2</span> <span class="ow">in</span> <span class="n">aas</span><span class="p">:</span>
        <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blosum50</span><span class="p">[</span><span class="n">aa1</span><span class="p">][</span><span class="n">aa2</span><span class="p">])</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="n">aa_labels</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aas</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_substitution_matrix</span><span class="p">(</span><span class="n">aa_labels</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">  A</th><th style="text-align: right;">  C</th><th style="text-align: right;">  D</th><th style="text-align: right;">  E</th><th style="text-align: right;">  F</th><th style="text-align: right;">  G</th><th style="text-align: right;">  H</th><th style="text-align: right;">  I</th><th style="text-align: right;">  K</th><th style="text-align: right;">  L</th><th style="text-align: right;">  M</th><th style="text-align: right;">  N</th><th style="text-align: right;">  P</th><th style="text-align: right;">  Q</th><th style="text-align: right;">  R</th><th style="text-align: right;">  S</th><th style="text-align: right;">  T</th><th style="text-align: right;">  V</th><th style="text-align: right;">  W</th><th style="text-align: right;">  Y</th></tr>
</thead>
<tbody>
<tr><td>A </td><td style="text-align: right;">  5</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  1</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td></tr>
<tr><td>C </td><td style="text-align: right;"> -1</td><td style="text-align: right;"> 13</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -5</td><td style="text-align: right;"> -3</td></tr>
<tr><td>D </td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  8</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -5</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -5</td><td style="text-align: right;"> -3</td></tr>
<tr><td>E </td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  2</td><td style="text-align: right;">  6</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td></tr>
<tr><td>F </td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -5</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  8</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  1</td><td style="text-align: right;">  4</td></tr>
<tr><td>G </td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  8</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td></tr>
<tr><td>H </td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> 10</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  2</td></tr>
<tr><td>I </td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  5</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  2</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td></tr>
<tr><td>K </td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  6</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  2</td><td style="text-align: right;">  3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td></tr>
<tr><td>L </td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  5</td><td style="text-align: right;">  3</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td></tr>
<tr><td>M </td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  3</td><td style="text-align: right;">  7</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  0</td></tr>
<tr><td>N </td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  0</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  7</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td></tr>
<tr><td>P </td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> 10</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td></tr>
<tr><td>Q </td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  7</td><td style="text-align: right;">  1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td></tr>
<tr><td>R </td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  1</td><td style="text-align: right;">  7</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td></tr>
<tr><td>S </td><td style="text-align: right;">  1</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  5</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -2</td></tr>
<tr><td>T </td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  2</td><td style="text-align: right;">  5</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td></tr>
<tr><td>V </td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -4</td><td style="text-align: right;">  4</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  1</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;">  5</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td></tr>
<tr><td>W </td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -5</td><td style="text-align: right;"> -5</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> 15</td><td style="text-align: right;">  2</td></tr>
<tr><td>Y </td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  4</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  2</td><td style="text-align: right;">  8</td></tr>
</tbody>
</table></div></div>
</div>
<div class="admonition-food-for-thought admonition">
<p class="admonition-title">Food for thought</p>
<p>Look at the scores in this matrix in the context of details about the biochemistry of the amino acids (see the molecular structures <a class="reference external" href="http://en.wikipedia.org/wiki/Amino_acid">on Wikipedia</a> or in any general microbiology or biochemistry text). Does a positive score represent a more or less favorable substitution? Confirm that the scores match your intuition for some similar and dissimilar amino acids.</p>
</div>
<p>You can look up individual substitution scores in this matrix as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">blosum50</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">][</span><span class="s1">&#39;G&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">blosum50</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">][</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">blosum50</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">][</span><span class="s1">&#39;K&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">blosum50</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">][</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">blosum50</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">][</span><span class="s1">&#39;W&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
0
-3
5
15
</pre></div>
</div>
</div>
</div>
<p>Early work on defining protein substitution matrices was performed by Margaret Dayhoff in the 1970s <span id="id2">[<a class="reference internal" href="#id23">MOD78</a>]</span> and by Steven Henikoff and Jorja Henikoff in the early 1990s <span id="id3">[<a class="reference internal" href="#id24">HH92</a>]</span>. Briefly, these matrices are often defined empirically, by aligning sequences manually or through automated systems, and counting how frequent certain substitutions are. Eddy (2004) <span id="id4">[<a class="reference internal" href="#id25">Edd04</a>]</span> presents a discussion on the source of the widely used substitution matrices by Sean Eddy. We’ll work with the BLOSUM 50 substitution matrix for the remainder of this chapter.</p>
</div>
<div class="section" id="a-better-approach-for-global-pairwise-alignment-using-the-needleman-wunsch-algorithm">
<span id="nw-alignment"></span><h2>A better approach for global pairwise alignment using the Needleman-Wunsch algorithm<a class="headerlink" href="#a-better-approach-for-global-pairwise-alignment-using-the-needleman-wunsch-algorithm" title="Permalink to this headline">¶</a></h2>
<p>We’re next going to work through the standard algorithm for aligning a pair of biological sequences. This algorithm was originally published by Saul B. Needleman and Christian D. Wunsch in 1970 <span id="id5">[<a class="reference internal" href="#id26">NW70</a>]</span>, and is therefore referred to as <em>Needleman-Wunsch alignment</em>. This performs what is known as <em>global alignment</em>, meaning that both sequences are aligned from their first amino acid residue (or base) through their last amino acid residue (or base). We’ll contrast this later in this chapter with local alignment.</p>
<div class="section" id="stepwise-needleman-wunsch-alignment">
<h3>Stepwise Needleman-Wunsch alignment<a class="headerlink" href="#stepwise-needleman-wunsch-alignment" title="Permalink to this headline">¶</a></h3>
<p>Needleman-Wunsch alignment is similar to the approach that we explored above. We’ll work through the steps of the algorithm first, and then automate the process by defining Python functions that perform the steps for us given a pair of sequences.</p>
<p>We’ll define two protein sequences to work with in this section. After working through this section, come back to this cell and change these protein sequences to explore how it changes the process. Make some small changes and some large changes to the protein sequences. The sequences that we’re starting with are the same that are used in Chapter 2 of <em>Biological Sequence Analysis</em> <span id="id6">[<a class="reference internal" href="#id27">Dur98</a>]</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio</span> <span class="kn">import</span> <span class="n">Protein</span>
<span class="n">seq1</span> <span class="o">=</span> <span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;HEAGAWGHEE&quot;</span><span class="p">)</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;PAWHEAE&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">seq1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seq2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HEAGAWGHEE
PAWHEAE
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-1-create-blank-matrices">
<h4>Step 1: Create blank matrices.<a class="headerlink" href="#step-1-create-blank-matrices" title="Permalink to this headline">¶</a></h4>
<p>As we discussed earlier in this chapter, a pair of sequences can be aligned in different ways. Needleman-Wunsch provides the best alignment, as defined by its score. Here we’ll compute two new matrices that together allow us to determine the highest alignment score given the sequences and the substitution matrix, and to transcribe the aligned sequences. These matrices are</p>
<ul class="simple">
<li><p>the <strong>dynamic programming matrix</strong>, or <span class="math notranslate nohighlight">\(F\)</span></p></li>
<li><p>and the <strong>traceback matrix</strong>, or <span class="math notranslate nohighlight">\(T\)</span>.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span> are defined at the same time.</p>
<p><span class="math notranslate nohighlight">\(F\)</span> looks a lot like the matrix we defined in our simplistic example above, but it has one extra row and column, corresponding to the start of each of the sequences (a <em>state</em> that is independent of the first residue of the sequences that is important for our algorithm). <span class="math notranslate nohighlight">\(F\)</span> keeps track of the best score of the alignment through the corresponding pair of positions, if the alignment were to terminate at that pair of positions.</p>
<p>Because there are multiple possible alignments that a score in <span class="math notranslate nohighlight">\(F\)</span> can be derived from, we use our second matrix, <span class="math notranslate nohighlight">\(T\)</span>, to track which single alignment led to each score in <span class="math notranslate nohighlight">\(F\)</span>. <span class="math notranslate nohighlight">\(T\)</span> has the same shape (i.e., numbers of rows and columns) as <span class="math notranslate nohighlight">\(F\)</span>, and its values encode information about how the sequences were aligned to result in the score in the corresponding cell in <span class="math notranslate nohighlight">\(F\)</span>.</p>
<p>Prior to initialization, <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span> would look like the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/3818343713.py:3: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  F = np.zeros(shape=(num_rows, num_cols), dtype=np.int)
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">   </th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  A</th><th style="text-align: right;">  G</th><th style="text-align: right;">  A</th><th style="text-align: right;">  W</th><th style="text-align: right;">  G</th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  E</th></tr>
</thead>
<tbody>
<tr><td>  </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>P </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>W </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>H </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>E </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>E </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
</tbody>
</table></div></div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_T</span><span class="p">(</span><span class="n">h_sequence</span><span class="p">,</span> <span class="n">v_sequence</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">:</span>
        <span class="n">data_</span> <span class="o">=</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="n">translation_table</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;•&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;↖&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;↑&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;←&quot;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">data_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span>  <span class="n">translation_table</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">show_F</span><span class="p">(</span><span class="n">h_sequence</span><span class="p">,</span> <span class="n">v_sequence</span><span class="p">,</span> <span class="n">data_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
<span class="n">show_T</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/335952657.py:1: DeprecationWarning: `np.str` is a deprecated alias for the builtin `str`. To silence this warning, use `str` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.str_` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  T = np.full(shape=(num_rows, num_cols), fill_value=&quot; &quot;, dtype=np.str)
/tmp/ipykernel_3474/668998788.py:2: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  if data.dtype == np.int:
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>   </th><th>H  </th><th>E  </th><th>A  </th><th>G  </th><th>A  </th><th>W  </th><th>G  </th><th>H  </th><th>E  </th><th>E  </th></tr>
</thead>
<tbody>
<tr><td>  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>P </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>W </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>H </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>E </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>E </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
</tbody>
</table></div></div>
</div>
</div>
<div class="section" id="step-2-compute-f-and-t">
<h4>Step 2: Compute <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>.<a class="headerlink" href="#step-2-compute-f-and-t" title="Permalink to this headline">¶</a></h4>
<p>The first row and column of <span class="math notranslate nohighlight">\(F\)</span> are initialized using the following formulas. <span class="math notranslate nohighlight">\(d\)</span> in these formulas is a value referred to as the <strong>gap penalty</strong>. This is a constant value that is subtracted from the score of the alignment every time a gap character has to be introduced to align the sequences. We’ll use a constant value of <span class="math notranslate nohighlight">\(d=8\)</span> (it’s positive because we subtract it) for now, and explore its use more shortly. <span class="math notranslate nohighlight">\(i\)</span> is the row number in <span class="math notranslate nohighlight">\(F\)</span>, and <span class="math notranslate nohighlight">\(j\)</span> is the column number in <span class="math notranslate nohighlight">\(F\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
&amp; F(0, 0) = 0\\
&amp; F(i, 0) = F(i-1, 0) - d\\
&amp; F(0, j) = F(0, j-1) - d\\
\end{align}
\end{split}\]</div>
<p>As an exercise, try computing the values for the cells in the first four rows in column zero and the first four columns in row zero of <span class="math notranslate nohighlight">\(F\)</span>. What you’ll notice is that the score that you compute for most of the cells (all of them except for <span class="math notranslate nohighlight">\(F(0, 0)\)</span>) depends on the score at another position in <span class="math notranslate nohighlight">\(F\)</span>. In a second matrix, <span class="math notranslate nohighlight">\(T\)</span>, draw an arrow from the cell that you’re currently defining the score for in <span class="math notranslate nohighlight">\(F\)</span> to the cell whose score it depends on. If the score depends on the cell above, you’d draw an up arrow (↑). If the score depends on the cell to the left, you’d draw a left arrow (←). If the score doesn’t depend on any other cell (you should have only one of these), indicate that with a bullet (•).</p>
<p>Initializing <span class="math notranslate nohighlight">\(F\)</span> would result in the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">):</span>
    <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">):</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span>

<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">   </th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  A</th><th style="text-align: right;">  G</th><th style="text-align: right;">  A</th><th style="text-align: right;">  W</th><th style="text-align: right;">  G</th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  E</th></tr>
</thead>
<tbody>
<tr><td>  </td><td style="text-align: right;">  0</td><td style="text-align: right;"> -8</td><td style="text-align: right;">-16</td><td style="text-align: right;">-24</td><td style="text-align: right;">-32</td><td style="text-align: right;">-40</td><td style="text-align: right;">-48</td><td style="text-align: right;">-56</td><td style="text-align: right;">-64</td><td style="text-align: right;">-72</td><td style="text-align: right;">-80</td></tr>
<tr><td>P </td><td style="text-align: right;"> -8</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">-16</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>W </td><td style="text-align: right;">-24</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>H </td><td style="text-align: right;">-32</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>E </td><td style="text-align: right;">-40</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">-48</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>E </td><td style="text-align: right;">-56</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
</tbody>
</table></div></div>
</div>
<p>Initializing <span class="math notranslate nohighlight">\(T\)</span> would result in the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;•&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">):</span>
    <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;↑&quot;</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">):</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;←&quot;</span>

<span class="n">show_T</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/668998788.py:2: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  if data.dtype == np.int:
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>   </th><th>H  </th><th>E  </th><th>A  </th><th>G  </th><th>A  </th><th>W  </th><th>G  </th><th>H  </th><th>E  </th><th>E  </th></tr>
</thead>
<tbody>
<tr><td>  </td><td>•  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td></tr>
<tr><td>P </td><td>↑  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>↑  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>W </td><td>↑  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>H </td><td>↑  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>E </td><td>↑  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>↑  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>E </td><td>↑  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
</tbody>
</table></div></div>
</div>
<p>Next, we’ll compute the scores for all of the other cells in <span class="math notranslate nohighlight">\(F\)</span>, starting at position <span class="math notranslate nohighlight">\((1, 1)\)</span>. In Needleman-Wunsch alignment, the score <span class="math notranslate nohighlight">\(F\)</span> for cell <span class="math notranslate nohighlight">\((i, j)\)</span> (when <span class="math notranslate nohighlight">\(i &gt; 0\)</span> and <span class="math notranslate nohighlight">\(j &gt; 0\)</span>) is computed as the maximum of three possible values. <span class="math notranslate nohighlight">\(s\)</span> refers to the substitution matrix, and <span class="math notranslate nohighlight">\(c_i\)</span> and <span class="math notranslate nohighlight">\(c_j\)</span> refer to characters in <code class="docutils literal notranslate"><span class="pre">seq1</span></code> and <code class="docutils literal notranslate"><span class="pre">seq2</span></code>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F(i, j) = max \left(\begin{align}
&amp; F(i-1, j-1) + s(c_i, c_j)\\
&amp; F(i-1, j) - d\\
&amp; F(i, j-1) - d
\end{align}\right)
\end{split}\]</div>
<p>Describing the scoring function in English, we score a cell with the maximum of three values: either the value of the cell up and to the left plus the score for the substitution taking place in the current cell (which you find by looking up the substitution in the substitution matrix); the value of the cell above minus the gap penalty; or the value of the cell to the left minus the gap penalty. In this way, you’re determining whether the best (highest) score is obtained by inserting a gap in sequence 1 (corresponding to <span class="math notranslate nohighlight">\(F(i-1, j) - d\)</span>), inserting a gap in sequence 2 (corresponding to <span class="math notranslate nohighlight">\(F(i, j-1) - d\)</span>), or aligning the characters in sequence 1 and sequence 2 (corresponding to <span class="math notranslate nohighlight">\(F(i-1, j-1) + s(c_i, c_j)\)</span>).</p>
<p>As an exercise, fill in the values of cells <span class="math notranslate nohighlight">\((1, 1)\)</span>, <span class="math notranslate nohighlight">\((1, 2)\)</span>, and <span class="math notranslate nohighlight">\((2, 1)\)</span> in <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>. Remember to insert arrows in <span class="math notranslate nohighlight">\(T\)</span> indicating which cell each score was derived from as you fill in the matrix. If you’re deriving the score for a given cell in <span class="math notranslate nohighlight">\(F\)</span> from the cell diagonally up and to the left, you should put a diagonal arrow in <span class="math notranslate nohighlight">\(T\)</span> (↖).</p>
<p>Notice the situation that you encounter when computing the value for <span class="math notranslate nohighlight">\(F(2, 1)\)</span>. Which arrow do you draw there? Keep this question in mind, and think about how it might impact your final result.</p>
<p>The function in the next cell generates the dynamic programming and traceback matrices for us. You should review this code to understand exactly how it’s working.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">format_dynamic_programming_matrix</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">cell_width</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; define a function for formatting dynamic programming matrices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">TabularMSA</span><span class="p">):</span>
        <span class="n">seq1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq2</span><span class="p">,</span> <span class="n">TabularMSA</span><span class="p">):</span>
        <span class="n">seq2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cell_format</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell_width</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
    <span class="n">line_format</span> <span class="o">=</span> <span class="n">cell_format</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># print seq1 (start the line with two empty strings)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_format</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">([</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">seq1</span><span class="p">)]))</span>

    <span class="c1"># iterate over the rows and print each (starting with the</span>
    <span class="c1"># corresponding base in sequence2)</span>
    <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">base</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">seq2</span><span class="p">):</span>
        <span class="n">row_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">base</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
            <span class="n">row_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line_format</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">row_list</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">format_traceback_matrix</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">cell_width</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">TabularMSA</span><span class="p">):</span>
        <span class="n">seq1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq2</span><span class="p">,</span> <span class="n">TabularMSA</span><span class="p">):</span>
        <span class="n">seq2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">translated_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">chararray</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">translated_m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">traceback_decoding</span><span class="p">[</span><span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">format_dynamic_programming_matrix</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">translated_m</span><span class="p">,</span>
                                             <span class="n">cell_width</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio.alignment._pairwise</span> <span class="kn">import</span> <span class="n">_compute_score_and_traceback_matrices</span>

<span class="o">%</span><span class="k">psource</span> _compute_score_and_traceback_matrices
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">def</span> _compute_score_and_traceback_matrices<span class=" -Color -Color-Blue">(</span>
        aln1<span class=" -Color -Color-Blue">,</span> aln2<span class=" -Color -Color-Blue">,</span> gap_open_penalty<span class=" -Color -Color-Blue">,</span> gap_extend_penalty<span class=" -Color -Color-Blue">,</span> substitution_matrix<span class=" -Color -Color-Blue">,</span>
        new_alignment_score<span class=" -Color -Color-Blue">=-</span>np<span class=" -Color -Color-Blue">.</span>inf<span class=" -Color -Color-Blue">,</span> init_matrices_f<span class=" -Color -Color-Blue">=</span>_init_matrices_nw<span class=" -Color -Color-Blue">,</span>
        penalize_terminal_gaps<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">True</span><span class=" -Color -Color-Blue">,</span> gap_substitution_score<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Cyan">0</span><span class=" -Color -Color-Blue">):</span>
    <span class=" -Color -Color-Blue">&quot;&quot;&quot;Return dynamic programming (score) and traceback matrices.</span>

<span class=" -Color -Color-Blue">    A note on the ``penalize_terminal_gaps`` parameter. When this value is</span>
<span class=" -Color -Color-Blue">    ``False``, this function is no longer true Smith-Waterman/Needleman-Wunsch</span>
<span class=" -Color -Color-Blue">    scoring, but when ``True`` it can result in biologically irrelevant</span>
<span class=" -Color -Color-Blue">    artifacts in Needleman-Wunsch (global) alignments. Specifically, if one</span>
<span class=" -Color -Color-Blue">    sequence is longer than the other (e.g., if aligning a primer sequence to</span>
<span class=" -Color -Color-Blue">    an amplification product, or searching for a gene in a genome) the shorter</span>
<span class=" -Color -Color-Blue">    sequence will have a long gap inserted. The parameter is ``True`` by</span>
<span class=" -Color -Color-Blue">    default (so that this function computes the score and traceback matrices as</span>
<span class=" -Color -Color-Blue">    described by the original authors) but the global alignment wrappers pass</span>
<span class=" -Color -Color-Blue">    ``False`` by default, so that the global alignment API returns the result</span>
<span class=" -Color -Color-Blue">    that users are most likely to be looking for.</span>

<span class=" -Color -Color-Blue">    &quot;&quot;&quot;</span>
    aln1_length <span class=" -Color -Color-Blue">=</span> aln1<span class=" -Color -Color-Blue">.</span>shape<span class=" -Color -Color-Blue">.</span>position
    aln2_length <span class=" -Color -Color-Blue">=</span> aln2<span class=" -Color -Color-Blue">.</span>shape<span class=" -Color -Color-Blue">.</span>position
    <span class=" -Color -Color-Red"># cache some values for quicker/simpler access</span>
    aend <span class=" -Color -Color-Blue">=</span> _traceback_encoding<span class=" -Color -Color-Blue">[&#39;alignment-end&#39;]</span>
    match <span class=" -Color -Color-Blue">=</span> _traceback_encoding<span class=" -Color -Color-Blue">[&#39;match&#39;]</span>
    vgap <span class=" -Color -Color-Blue">=</span> _traceback_encoding<span class=" -Color -Color-Blue">[&#39;vertical-gap&#39;]</span>
    hgap <span class=" -Color -Color-Blue">=</span> _traceback_encoding<span class=" -Color -Color-Blue">[&#39;horizontal-gap&#39;]</span>

    new_alignment_score <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">(</span>new_alignment_score<span class=" -Color -Color-Blue">,</span> aend<span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Red"># Initialize a matrix to use for scoring the alignment and for tracing</span>
    <span class=" -Color -Color-Red"># back the best alignment</span>
    score_matrix<span class=" -Color -Color-Blue">,</span> traceback_matrix <span class=" -Color -Color-Blue">=</span> init_matrices_f<span class=" -Color -Color-Blue">(</span>
        aln1<span class=" -Color -Color-Blue">,</span> aln2<span class=" -Color -Color-Blue">,</span> gap_open_penalty<span class=" -Color -Color-Blue">,</span> gap_extend_penalty<span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Red"># Iterate over the characters in aln2 (which corresponds to the vertical</span>
    <span class=" -Color -Color-Red"># sequence in the matrix)</span>
    <span class=" -Color -Color-Green">for</span> aln2_pos<span class=" -Color -Color-Blue">,</span> aln2_chars <span class=" -Color -Color-Green">in</span> enumerate<span class=" -Color -Color-Blue">(</span>aln2<span class=" -Color -Color-Blue">.</span>iter_positions<span class=" -Color -Color-Blue">(</span>
            ignore_metadata<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">True</span><span class=" -Color -Color-Blue">),</span> <span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">):</span>
        aln2_chars <span class=" -Color -Color-Blue">=</span> str<span class=" -Color -Color-Blue">(</span>aln2_chars<span class=" -Color -Color-Blue">)</span>

        <span class=" -Color -Color-Red"># Iterate over the characters in aln1 (which corresponds to the</span>
        <span class=" -Color -Color-Red"># horizontal sequence in the matrix)</span>
        <span class=" -Color -Color-Green">for</span> aln1_pos<span class=" -Color -Color-Blue">,</span> aln1_chars <span class=" -Color -Color-Green">in</span> enumerate<span class=" -Color -Color-Blue">(</span>aln1<span class=" -Color -Color-Blue">.</span>iter_positions<span class=" -Color -Color-Blue">(</span>
                ignore_metadata<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">True</span><span class=" -Color -Color-Blue">),</span> <span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">):</span>
            aln1_chars <span class=" -Color -Color-Blue">=</span> str<span class=" -Color -Color-Blue">(</span>aln1_chars<span class=" -Color -Color-Blue">)</span>

            <span class=" -Color -Color-Red"># compute the score for a match/mismatch</span>
            substitution_score <span class=" -Color -Color-Blue">=</span> _compute_substitution_score<span class=" -Color -Color-Blue">(</span>
                aln1_chars<span class=" -Color -Color-Blue">,</span> aln2_chars<span class=" -Color -Color-Blue">,</span> substitution_matrix<span class=" -Color -Color-Blue">,</span>
                gap_substitution_score<span class=" -Color -Color-Blue">,</span> aln1<span class=" -Color -Color-Blue">.</span>dtype<span class=" -Color -Color-Blue">.</span>gap_chars<span class=" -Color -Color-Blue">)</span>

            diag_score <span class=" -Color -Color-Blue">=</span> \
                <span class=" -Color -Color-Blue">(</span>score_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">+</span> substitution_score<span class=" -Color -Color-Blue">,</span>
                 match<span class=" -Color -Color-Blue">)</span>

            <span class=" -Color -Color-Red"># compute the score for adding a gap in aln2 (vertical)</span>
            <span class=" -Color -Color-Green">if</span> <span class=" -Color -Color-Green">not</span> penalize_terminal_gaps <span class=" -Color -Color-Green">and</span> <span class=" -Color -Color-Blue">(</span>aln1_pos <span class=" -Color -Color-Blue">==</span> aln1_length<span class=" -Color -Color-Blue">):</span>
                <span class=" -Color -Color-Red"># we&#39;ve reached the end of aln1, so adding vertical gaps</span>
                <span class=" -Color -Color-Red"># (which become gaps in aln1) should no longer</span>
                <span class=" -Color -Color-Red"># be penalized (if penalize_terminal_gaps == False)</span>
                up_score <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">(</span>score_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">],</span> vgap<span class=" -Color -Color-Blue">)</span>
            <span class=" -Color -Color-Green">elif</span> traceback_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">==</span> vgap<span class=" -Color -Color-Blue">:</span>
                <span class=" -Color -Color-Red"># gap extend, because the cell above was also a gap</span>
                up_score <span class=" -Color -Color-Blue">=</span> \
                    <span class=" -Color -Color-Blue">(</span>score_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">-</span> gap_extend_penalty<span class=" -Color -Color-Blue">,</span>
                     vgap<span class=" -Color -Color-Blue">)</span>
            <span class=" -Color -Color-Green">else</span><span class=" -Color -Color-Blue">:</span>
                <span class=" -Color -Color-Red"># gap open, because the cell above was not a gap</span>
                up_score <span class=" -Color -Color-Blue">=</span> \
                    <span class=" -Color -Color-Blue">(</span>score_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">-</span> gap_open_penalty<span class=" -Color -Color-Blue">,</span>
                     vgap<span class=" -Color -Color-Blue">)</span>

            <span class=" -Color -Color-Red"># compute the score for adding a gap in aln1 (horizontal)</span>
            <span class=" -Color -Color-Green">if</span> <span class=" -Color -Color-Green">not</span> penalize_terminal_gaps <span class=" -Color -Color-Green">and</span> <span class=" -Color -Color-Blue">(</span>aln2_pos <span class=" -Color -Color-Blue">==</span> aln2_length<span class=" -Color -Color-Blue">):</span>
                <span class=" -Color -Color-Red"># we&#39;ve reached the end of aln2, so adding horizontal gaps</span>
                <span class=" -Color -Color-Red"># (which become gaps in aln2) should no longer</span>
                <span class=" -Color -Color-Red"># be penalized (if penalize_terminal_gaps == False)</span>
                left_score <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">(</span>score_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">],</span> hgap<span class=" -Color -Color-Blue">)</span>
            <span class=" -Color -Color-Green">elif</span> traceback_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">==</span> hgap<span class=" -Color -Color-Blue">:</span>
                <span class=" -Color -Color-Red"># gap extend, because the cell to the left was also a gap</span>
                left_score <span class=" -Color -Color-Blue">=</span> \
                    <span class=" -Color -Color-Blue">(</span>score_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">-</span> gap_extend_penalty<span class=" -Color -Color-Blue">,</span>
                     hgap<span class=" -Color -Color-Blue">)</span>
            <span class=" -Color -Color-Green">else</span><span class=" -Color -Color-Blue">:</span>
                <span class=" -Color -Color-Red"># gap open, because the cell to the left was not a gap</span>
                left_score <span class=" -Color -Color-Blue">=</span> \
                    <span class=" -Color -Color-Blue">(</span>score_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">-</span> gap_open_penalty<span class=" -Color -Color-Blue">,</span>
                     hgap<span class=" -Color -Color-Blue">)</span>

            <span class=" -Color -Color-Red"># identify the largest score, and use that information to populate</span>
            <span class=" -Color -Color-Red"># the score and traceback matrices</span>
            best_score <span class=" -Color -Color-Blue">=</span> _first_largest<span class=" -Color -Color-Blue">([</span>new_alignment_score<span class=" -Color -Color-Blue">,</span> left_score<span class=" -Color -Color-Blue">,</span>
                                         diag_score<span class=" -Color -Color-Blue">,</span> up_score<span class=" -Color -Color-Blue">])</span>
            score_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">=</span> best_score<span class=" -Color -Color-Blue">[</span><span class=" -Color -Color-Cyan">0</span><span class=" -Color -Color-Blue">]</span>
            traceback_matrix<span class=" -Color -Color-Blue">[</span>aln2_pos<span class=" -Color -Color-Blue">,</span> aln1_pos<span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">=</span> best_score<span class=" -Color -Color-Blue">[</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]</span>

    <span class=" -Color -Color-Green">return</span> score_matrix<span class=" -Color -Color-Blue">,</span> traceback_matrix
</pre></div>
</div>
</div>
</div>
<p>You can now apply this function to <code class="docutils literal notranslate"><span class="pre">seq1</span></code> and <code class="docutils literal notranslate"><span class="pre">seq2</span></code> to compute the dynamic programming and traceback matrices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio.sequence</span> <span class="kn">import</span> <span class="n">Protein</span>
<span class="kn">from</span> <span class="nn">skbio.alignment</span> <span class="kn">import</span> <span class="n">TabularMSA</span>

<span class="n">seq1</span> <span class="o">=</span> <span class="n">TabularMSA</span><span class="p">([</span><span class="n">seq1</span><span class="p">])</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">TabularMSA</span><span class="p">([</span><span class="n">seq2</span><span class="p">])</span>

<span class="n">nw_matrix</span><span class="p">,</span> <span class="n">traceback_matrix</span> <span class="o">=</span> <span class="n">_compute_score_and_traceback_matrices</span><span class="p">(</span>
    <span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">blosum50</span><span class="p">)</span>

<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nw_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">   </th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  A</th><th style="text-align: right;">  G</th><th style="text-align: right;">  A</th><th style="text-align: right;">  W</th><th style="text-align: right;">  G</th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  E</th></tr>
</thead>
<tbody>
<tr><td>  </td><td style="text-align: right;">  0</td><td style="text-align: right;"> -8</td><td style="text-align: right;">-16</td><td style="text-align: right;">-24</td><td style="text-align: right;">-32</td><td style="text-align: right;">-40</td><td style="text-align: right;">-48</td><td style="text-align: right;">-56</td><td style="text-align: right;">-64</td><td style="text-align: right;">-72</td><td style="text-align: right;">-80</td></tr>
<tr><td>P </td><td style="text-align: right;"> -8</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -9</td><td style="text-align: right;">-17</td><td style="text-align: right;">-25</td><td style="text-align: right;">-33</td><td style="text-align: right;">-41</td><td style="text-align: right;">-49</td><td style="text-align: right;">-57</td><td style="text-align: right;">-65</td><td style="text-align: right;">-73</td></tr>
<tr><td>A </td><td style="text-align: right;">-16</td><td style="text-align: right;">-10</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;">-12</td><td style="text-align: right;">-20</td><td style="text-align: right;">-28</td><td style="text-align: right;">-36</td><td style="text-align: right;">-44</td><td style="text-align: right;">-52</td><td style="text-align: right;">-60</td></tr>
<tr><td>W </td><td style="text-align: right;">-24</td><td style="text-align: right;">-18</td><td style="text-align: right;">-11</td><td style="text-align: right;"> -6</td><td style="text-align: right;"> -7</td><td style="text-align: right;">-15</td><td style="text-align: right;"> -5</td><td style="text-align: right;">-13</td><td style="text-align: right;">-21</td><td style="text-align: right;">-29</td><td style="text-align: right;">-37</td></tr>
<tr><td>H </td><td style="text-align: right;">-32</td><td style="text-align: right;">-14</td><td style="text-align: right;">-18</td><td style="text-align: right;">-13</td><td style="text-align: right;"> -8</td><td style="text-align: right;"> -9</td><td style="text-align: right;">-13</td><td style="text-align: right;"> -7</td><td style="text-align: right;"> -3</td><td style="text-align: right;">-11</td><td style="text-align: right;">-19</td></tr>
<tr><td>E </td><td style="text-align: right;">-40</td><td style="text-align: right;">-22</td><td style="text-align: right;"> -8</td><td style="text-align: right;">-16</td><td style="text-align: right;">-16</td><td style="text-align: right;"> -9</td><td style="text-align: right;">-12</td><td style="text-align: right;">-15</td><td style="text-align: right;"> -7</td><td style="text-align: right;">  3</td><td style="text-align: right;"> -5</td></tr>
<tr><td>A </td><td style="text-align: right;">-48</td><td style="text-align: right;">-30</td><td style="text-align: right;">-16</td><td style="text-align: right;"> -3</td><td style="text-align: right;">-11</td><td style="text-align: right;">-11</td><td style="text-align: right;">-12</td><td style="text-align: right;">-12</td><td style="text-align: right;">-15</td><td style="text-align: right;"> -5</td><td style="text-align: right;">  2</td></tr>
<tr><td>E </td><td style="text-align: right;">-56</td><td style="text-align: right;">-38</td><td style="text-align: right;">-24</td><td style="text-align: right;">-11</td><td style="text-align: right;"> -6</td><td style="text-align: right;">-12</td><td style="text-align: right;">-14</td><td style="text-align: right;">-15</td><td style="text-align: right;">-12</td><td style="text-align: right;"> -9</td><td style="text-align: right;">  1</td></tr>
</tbody>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_T</span><span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">traceback_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/668998788.py:2: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  if data.dtype == np.int:
/tmp/ipykernel_3474/668998788.py:3: DeprecationWarning: `np.str` is a deprecated alias for the builtin `str`. To silence this warning, use `str` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.str_` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  data_ = T = np.full(shape=data.shape, fill_value=&quot; &quot;, dtype=np.str)
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>   </th><th>H  </th><th>E  </th><th>A  </th><th>G  </th><th>A  </th><th>W  </th><th>G  </th><th>H  </th><th>E  </th><th>E  </th></tr>
</thead>
<tbody>
<tr><td>  </td><td>•  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td></tr>
<tr><td>P </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td></tr>
<tr><td>A </td><td>↑  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td></tr>
<tr><td>W </td><td>↑  </td><td>↑  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td><td>↖  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td></tr>
<tr><td>H </td><td>↑  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td><td>←  </td></tr>
<tr><td>E </td><td>↑  </td><td>↑  </td><td>↖  </td><td>←  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td></tr>
<tr><td>A </td><td>↑  </td><td>↑  </td><td>↑  </td><td>↖  </td><td>←  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↑  </td><td>↑  </td><td>↖  </td></tr>
<tr><td>E </td><td>↑  </td><td>↑  </td><td>↖  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td></tr>
</tbody>
</table></div></div>
</div>
</div>
<div class="section" id="step-3-transcribe-the-alignment">
<h4>Step 3: Transcribe the alignment.<a class="headerlink" href="#step-3-transcribe-the-alignment" title="Permalink to this headline">¶</a></h4>
<p>We can now use <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span> to transcribe and score the alignment of sequences 1 and 2. To do this, we start at the bottom-right of the matrices and follow the arrows to cell <span class="math notranslate nohighlight">\((0, 0)\)</span>.</p>
<ul class="simple">
<li><p>Every time we encounter a vertical arrow, we consume a character from sequence 2 (the vertical sequence) and add a gap to sequence 1.</p></li>
<li><p>Every time we encounter a horizontal arrow, we consume a character from sequence 1 (the horizontal sequence) and add a gap to sequence 2.</p></li>
<li><p>Every time we encounter a diagonal arrow, we consume a character from sequence 1 and sequence 2.</p></li>
<li><p>When we encounter a bullet, we’ve reached the end of the alignment so we’re done.</p></li>
</ul>
<p>As you transcribe the alignment, write sequence 1 on top of sequence 2, and work from right to left (since you are working backwards through the matrix).</p>
<p>The score in the cell that you started in (the bottom-right in this case) is the score for the alignment.</p>
<p>Work through this process on paper, and then review the function in the next cell to see how this looks in Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio.alignment._pairwise</span> <span class="kn">import</span> <span class="n">_traceback</span>
<span class="o">%</span><span class="k">psource</span> _traceback
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">def</span> _traceback<span class=" -Color -Color-Blue">(</span>traceback_matrix<span class=" -Color -Color-Blue">,</span> score_matrix<span class=" -Color -Color-Blue">,</span> aln1<span class=" -Color -Color-Blue">,</span> aln2<span class=" -Color -Color-Blue">,</span> start_row<span class=" -Color -Color-Blue">,</span>
               start_col<span class=" -Color -Color-Blue">):</span>
    <span class=" -Color -Color-Red"># cache some values for simpler reference</span>
    aend <span class=" -Color -Color-Blue">=</span> _traceback_encoding<span class=" -Color -Color-Blue">[&#39;alignment-end&#39;]</span>
    match <span class=" -Color -Color-Blue">=</span> _traceback_encoding<span class=" -Color -Color-Blue">[&#39;match&#39;]</span>
    vgap <span class=" -Color -Color-Blue">=</span> _traceback_encoding<span class=" -Color -Color-Blue">[&#39;vertical-gap&#39;]</span>
    hgap <span class=" -Color -Color-Blue">=</span> _traceback_encoding<span class=" -Color -Color-Blue">[&#39;horizontal-gap&#39;]</span>
    gap_character <span class=" -Color -Color-Blue">=</span> aln1<span class=" -Color -Color-Blue">.</span>dtype<span class=" -Color -Color-Blue">.</span>default_gap_char

    <span class=" -Color -Color-Red"># initialize the result alignments</span>
    aln1_sequence_count <span class=" -Color -Color-Blue">=</span> aln1<span class=" -Color -Color-Blue">.</span>shape<span class=" -Color -Color-Blue">.</span>sequence
    aligned_seqs1 <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">[[]</span> <span class=" -Color -Color-Green">for</span> e <span class=" -Color -Color-Green">in</span> range<span class=" -Color -Color-Blue">(</span>aln1_sequence_count<span class=" -Color -Color-Blue">)]</span>

    aln2_sequence_count <span class=" -Color -Color-Blue">=</span> aln2<span class=" -Color -Color-Blue">.</span>shape<span class=" -Color -Color-Blue">.</span>sequence
    aligned_seqs2 <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">[[]</span> <span class=" -Color -Color-Green">for</span> e <span class=" -Color -Color-Green">in</span> range<span class=" -Color -Color-Blue">(</span>aln2_sequence_count<span class=" -Color -Color-Blue">)]</span>

    current_row <span class=" -Color -Color-Blue">=</span> start_row
    current_col <span class=" -Color -Color-Blue">=</span> start_col

    best_score <span class=" -Color -Color-Blue">=</span> score_matrix<span class=" -Color -Color-Blue">[</span>current_row<span class=" -Color -Color-Blue">,</span> current_col<span class=" -Color -Color-Blue">]</span>
    current_value <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Green">None</span>

    <span class=" -Color -Color-Green">while</span> current_value <span class=" -Color -Color-Blue">!=</span> aend<span class=" -Color -Color-Blue">:</span>
        current_value <span class=" -Color -Color-Blue">=</span> traceback_matrix<span class=" -Color -Color-Blue">[</span>current_row<span class=" -Color -Color-Blue">,</span> current_col<span class=" -Color -Color-Blue">]</span>

        <span class=" -Color -Color-Green">if</span> current_value <span class=" -Color -Color-Blue">==</span> match<span class=" -Color -Color-Blue">:</span>
            <span class=" -Color -Color-Green">for</span> aligned_seq<span class=" -Color -Color-Blue">,</span> input_seq <span class=" -Color -Color-Green">in</span> zip<span class=" -Color -Color-Blue">(</span>aligned_seqs1<span class=" -Color -Color-Blue">,</span> aln1<span class=" -Color -Color-Blue">):</span>
                aligned_seq<span class=" -Color -Color-Blue">.</span>append<span class=" -Color -Color-Blue">(</span>str<span class=" -Color -Color-Blue">(</span>input_seq<span class=" -Color -Color-Blue">[</span>current_col<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]))</span>
            <span class=" -Color -Color-Green">for</span> aligned_seq<span class=" -Color -Color-Blue">,</span> input_seq <span class=" -Color -Color-Green">in</span> zip<span class=" -Color -Color-Blue">(</span>aligned_seqs2<span class=" -Color -Color-Blue">,</span> aln2<span class=" -Color -Color-Blue">):</span>
                aligned_seq<span class=" -Color -Color-Blue">.</span>append<span class=" -Color -Color-Blue">(</span>str<span class=" -Color -Color-Blue">(</span>input_seq<span class=" -Color -Color-Blue">[</span>current_row<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]))</span>
            current_row <span class=" -Color -Color-Blue">-=</span> <span class=" -Color -Color-Cyan">1</span>
            current_col <span class=" -Color -Color-Blue">-=</span> <span class=" -Color -Color-Cyan">1</span>
        <span class=" -Color -Color-Green">elif</span> current_value <span class=" -Color -Color-Blue">==</span> vgap<span class=" -Color -Color-Blue">:</span>
            <span class=" -Color -Color-Green">for</span> aligned_seq <span class=" -Color -Color-Green">in</span> aligned_seqs1<span class=" -Color -Color-Blue">:</span>
                aligned_seq<span class=" -Color -Color-Blue">.</span>append<span class=" -Color -Color-Blue">(</span>gap_character<span class=" -Color -Color-Blue">)</span>
            <span class=" -Color -Color-Green">for</span> aligned_seq<span class=" -Color -Color-Blue">,</span> input_seq <span class=" -Color -Color-Green">in</span> zip<span class=" -Color -Color-Blue">(</span>aligned_seqs2<span class=" -Color -Color-Blue">,</span> aln2<span class=" -Color -Color-Blue">):</span>
                aligned_seq<span class=" -Color -Color-Blue">.</span>append<span class=" -Color -Color-Blue">(</span>str<span class=" -Color -Color-Blue">(</span>input_seq<span class=" -Color -Color-Blue">[</span>current_row<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]))</span>
            current_row <span class=" -Color -Color-Blue">-=</span> <span class=" -Color -Color-Cyan">1</span>
        <span class=" -Color -Color-Green">elif</span> current_value <span class=" -Color -Color-Blue">==</span> hgap<span class=" -Color -Color-Blue">:</span>
            <span class=" -Color -Color-Green">for</span> aligned_seq<span class=" -Color -Color-Blue">,</span> input_seq <span class=" -Color -Color-Green">in</span> zip<span class=" -Color -Color-Blue">(</span>aligned_seqs1<span class=" -Color -Color-Blue">,</span> aln1<span class=" -Color -Color-Blue">):</span>
                aligned_seq<span class=" -Color -Color-Blue">.</span>append<span class=" -Color -Color-Blue">(</span>str<span class=" -Color -Color-Blue">(</span>input_seq<span class=" -Color -Color-Blue">[</span>current_col<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]))</span>
            <span class=" -Color -Color-Green">for</span> aligned_seq <span class=" -Color -Color-Green">in</span> aligned_seqs2<span class=" -Color -Color-Blue">:</span>
                aligned_seq<span class=" -Color -Color-Blue">.</span>append<span class=" -Color -Color-Blue">(</span>gap_character<span class=" -Color -Color-Blue">)</span>
            current_col <span class=" -Color -Color-Blue">-=</span> <span class=" -Color -Color-Cyan">1</span>
        <span class=" -Color -Color-Green">elif</span> current_value <span class=" -Color -Color-Blue">==</span> aend<span class=" -Color -Color-Blue">:</span>
            <span class=" -Color -Color-Green">continue</span>
        <span class=" -Color -Color-Green">else</span><span class=" -Color -Color-Blue">:</span>
            <span class=" -Color -Color-Green">raise</span> ValueError<span class=" -Color -Color-Blue">(</span>
                <span class=" -Color -Color-Blue">&quot;Invalid value in traceback matrix: %s&quot;</span> <span class=" -Color -Color-Blue">%</span> current_value<span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Green">for</span> i<span class=" -Color -Color-Blue">,</span> <span class=" -Color -Color-Blue">(</span>aligned_seq<span class=" -Color -Color-Blue">,</span> original<span class=" -Color -Color-Blue">)</span> <span class=" -Color -Color-Green">in</span> enumerate<span class=" -Color -Color-Blue">(</span>zip<span class=" -Color -Color-Blue">(</span>aligned_seqs1<span class=" -Color -Color-Blue">,</span> aln1<span class=" -Color -Color-Blue">)):</span>
        aligned_seq <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">&#39;&#39;.</span>join<span class=" -Color -Color-Blue">(</span>aligned_seq<span class=" -Color -Color-Blue">)[::-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]</span>
        constructor <span class=" -Color -Color-Blue">=</span> aln1<span class=" -Color -Color-Blue">.</span>dtype
        metadata <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Green">None</span>
        <span class=" -Color -Color-Green">if</span> original<span class=" -Color -Color-Blue">.</span>has_metadata<span class=" -Color -Color-Blue">():</span>
            metadata <span class=" -Color -Color-Blue">=</span> original<span class=" -Color -Color-Blue">.</span>metadata
        aligned_seqs1<span class=" -Color -Color-Blue">[</span>i<span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">=</span> constructor<span class=" -Color -Color-Blue">(</span>aligned_seq<span class=" -Color -Color-Blue">,</span> metadata<span class=" -Color -Color-Blue">=</span>metadata<span class=" -Color -Color-Blue">,</span>
                                       validate<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">False</span><span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Green">for</span> i<span class=" -Color -Color-Blue">,</span> <span class=" -Color -Color-Blue">(</span>aligned_seq<span class=" -Color -Color-Blue">,</span> original<span class=" -Color -Color-Blue">)</span> <span class=" -Color -Color-Green">in</span> enumerate<span class=" -Color -Color-Blue">(</span>zip<span class=" -Color -Color-Blue">(</span>aligned_seqs2<span class=" -Color -Color-Blue">,</span> aln2<span class=" -Color -Color-Blue">)):</span>
        aligned_seq <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">&#39;&#39;.</span>join<span class=" -Color -Color-Blue">(</span>aligned_seq<span class=" -Color -Color-Blue">)[::-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]</span>
        constructor <span class=" -Color -Color-Blue">=</span> aln2<span class=" -Color -Color-Blue">.</span>dtype
        metadata <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Green">None</span>
        <span class=" -Color -Color-Green">if</span> original<span class=" -Color -Color-Blue">.</span>has_metadata<span class=" -Color -Color-Blue">():</span>
            metadata <span class=" -Color -Color-Blue">=</span> original<span class=" -Color -Color-Blue">.</span>metadata
        aligned_seqs2<span class=" -Color -Color-Blue">[</span>i<span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">=</span> constructor<span class=" -Color -Color-Blue">(</span>aligned_seq<span class=" -Color -Color-Blue">,</span> metadata<span class=" -Color -Color-Blue">=</span>metadata<span class=" -Color -Color-Blue">,</span>
                                       validate<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">False</span><span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Green">return</span> aligned_seqs1<span class=" -Color -Color-Blue">,</span> aligned_seqs2<span class=" -Color -Color-Blue">,</span> best_score<span class=" -Color -Color-Blue">,</span> current_col<span class=" -Color -Color-Blue">,</span> current_row
</pre></div>
</div>
</div>
</div>
<p>You can then execute this as follows, and print out the resulting alignment. Compare the result that you obtained with the result of calling this function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aln1</span><span class="p">,</span> <span class="n">aln2</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_traceback</span><span class="p">(</span><span class="n">traceback_matrix</span><span class="p">,</span><span class="n">nw_matrix</span><span class="p">,</span><span class="n">seq1</span><span class="p">,</span><span class="n">seq2</span><span class="p">,</span> <span class="n">nw_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nw_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">aln1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">aln2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HEAGAWGHE-E
-PA--W-HEAE
1.0
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="automating-needleman-wunsch-alignment-with-python">
<h3>Automating Needleman-Wunsch alignment with Python<a class="headerlink" href="#automating-needleman-wunsch-alignment-with-python" title="Permalink to this headline">¶</a></h3>
<p>Calling the steps we just described is labor-intensive, and they don’t change regardless of the protein sequences that we want to align. So, as a bioinformatics software developer, you’d want to make this functionality more easily accessible to users. To do that, you’d define a function that takes all of the necessary input and provides the aligned sequences and the score as output, without requiring the user to make several function calls.</p>
<p>Think for a minute about how you’d define this function. What are the required inputs? What would the function provide as output? What would be a good name for the function? (Naming functions is hard: you want the name to be self-documenting, so users know what the function does, but you also want it to be concise because you and your users will be typing it often.) Write your answers to these questions down. What you’re doing here is sketching an <em>Application Programmer Interface</em>, or <em>API</em> for a function. Defining APIs is a bit of an art and a bit of a science, and there are great APIs and horrible APIs. API definition is hard, and it’s something that you get better at with practice. Spending time thinking about APIs is important for developers, as it’s how your users will interact with your code. There is a lot of good code out there that no one uses because it has a bad API.</p>
<p>Here’s the scikit-bio implementation of Needleman-Wunsch alignment. How is its API different from the interface you sketched out above?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio.alignment</span> <span class="kn">import</span> <span class="n">global_pairwise_align</span>
<span class="o">%</span><span class="k">psource</span> global_pairwise_align
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">@</span>experimental<span class=" -Color -Color-Blue">(</span>as_of<span class=" -Color -Color-Blue">=&quot;0.4.0&quot;)</span>
<span class=" -Color -Color-Green">def</span> global_pairwise_align<span class=" -Color -Color-Blue">(</span>seq1<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">,</span> gap_open_penalty<span class=" -Color -Color-Blue">,</span> gap_extend_penalty<span class=" -Color -Color-Blue">,</span>
                          substitution_matrix<span class=" -Color -Color-Blue">,</span> penalize_terminal_gaps<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Green">False</span><span class=" -Color -Color-Blue">):</span>
    <span class=" -Color -Color-Blue">&quot;&quot;&quot;Globally align a pair of seqs or alignments with Needleman-Wunsch</span>

<span class=" -Color -Color-Blue">    Parameters</span>
<span class=" -Color -Color-Blue">    ----------</span>
<span class=" -Color -Color-Blue">    seq1 : GrammaredSequence or TabularMSA</span>
<span class=" -Color -Color-Blue">        The first unaligned sequence(s).</span>
<span class=" -Color -Color-Blue">    seq2 : GrammaredSequence or TabularMSA</span>
<span class=" -Color -Color-Blue">        The second unaligned sequence(s).</span>
<span class=" -Color -Color-Blue">    gap_open_penalty : int or float</span>
<span class=" -Color -Color-Blue">        Penalty for opening a gap (this is substracted from previous best</span>
<span class=" -Color -Color-Blue">        alignment score, so is typically positive).</span>
<span class=" -Color -Color-Blue">    gap_extend_penalty : int or float</span>
<span class=" -Color -Color-Blue">        Penalty for extending a gap (this is substracted from previous best</span>
<span class=" -Color -Color-Blue">        alignment score, so is typically positive).</span>
<span class=" -Color -Color-Blue">    substitution_matrix: 2D dict (or similar)</span>
<span class=" -Color -Color-Blue">        Lookup for substitution scores (these values are added to the</span>
<span class=" -Color -Color-Blue">        previous best alignment score).</span>
<span class=" -Color -Color-Blue">    penalize_terminal_gaps: bool, optional</span>
<span class=" -Color -Color-Blue">        If True, will continue to penalize gaps even after one sequence has</span>
<span class=" -Color -Color-Blue">        been aligned through its end. This behavior is true Needleman-Wunsch</span>
<span class=" -Color -Color-Blue">        alignment, but results in (biologically irrelevant) artifacts when</span>
<span class=" -Color -Color-Blue">        the sequences being aligned are of different length. This is ``False``</span>
<span class=" -Color -Color-Blue">        by default, which is very likely to be the behavior you want in all or</span>
<span class=" -Color -Color-Blue">        nearly all cases.</span>

<span class=" -Color -Color-Blue">    Returns</span>
<span class=" -Color -Color-Blue">    -------</span>
<span class=" -Color -Color-Blue">    tuple</span>
<span class=" -Color -Color-Blue">        ``TabularMSA`` object containing the aligned sequences, alignment score</span>
<span class=" -Color -Color-Blue">        (float), and start/end positions of each input sequence (iterable</span>
<span class=" -Color -Color-Blue">        of two-item tuples). Note that start/end positions are indexes into the</span>
<span class=" -Color -Color-Blue">        unaligned sequences.</span>

<span class=" -Color -Color-Blue">    See Also</span>
<span class=" -Color -Color-Blue">    --------</span>
<span class=" -Color -Color-Blue">    local_pairwise_align</span>
<span class=" -Color -Color-Blue">    local_pairwise_align_protein</span>
<span class=" -Color -Color-Blue">    local_pairwise_align_nucleotide</span>
<span class=" -Color -Color-Blue">    skbio.alignment.local_pairwise_align_ssw</span>
<span class=" -Color -Color-Blue">    global_pairwise_align_protein</span>
<span class=" -Color -Color-Blue">    global_pairwise_align_nucelotide</span>

<span class=" -Color -Color-Blue">    Notes</span>
<span class=" -Color -Color-Blue">    -----</span>
<span class=" -Color -Color-Blue">    This algorithm (in a slightly more basic form) was originally described</span>
<span class=" -Color -Color-Blue">    in [1]_. The scikit-bio implementation was validated against the</span>
<span class=" -Color -Color-Blue">    EMBOSS needle web server [2]_.</span>

<span class=" -Color -Color-Blue">    This function can be use to align either a pair of sequences, a pair of</span>
<span class=" -Color -Color-Blue">    alignments, or a sequence and an alignment.</span>

<span class=" -Color -Color-Blue">    References</span>
<span class=" -Color -Color-Blue">    ----------</span>
<span class=" -Color -Color-Blue">    .. [1] A general method applicable to the search for similarities in</span>
<span class=" -Color -Color-Blue">       the amino acid sequence of two proteins.</span>
<span class=" -Color -Color-Blue">       Needleman SB, Wunsch CD.</span>
<span class=" -Color -Color-Blue">       J Mol Biol. 1970 Mar;48(3):443-53.</span>
<span class=" -Color -Color-Blue">    .. [2] http://www.ebi.ac.uk/Tools/psa/emboss_needle/</span>

<span class=" -Color -Color-Blue">    &quot;&quot;&quot;</span>
    warn<span class=" -Color -Color-Blue">(&quot;You&#39;re using skbio&#39;s python implementation of Needleman-Wunsch &quot;</span>
         <span class=" -Color -Color-Blue">&quot;alignment. This is known to be very slow (e.g., thousands of times &quot;</span>
         <span class=" -Color -Color-Blue">&quot;slower than a native C implementation). We&#39;ll be adding a faster &quot;</span>
         <span class=" -Color -Color-Blue">&quot;version soon (see https://github.com/biocore/scikit-bio/issues/254 &quot;</span>
         <span class=" -Color -Color-Blue">&quot;to track progress on this).&quot;,</span> EfficiencyWarning<span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Green">for</span> seq <span class=" -Color -Color-Green">in</span> seq1<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">:</span>
        <span class=" -Color -Color-Red"># We don&#39;t need to check the case where `seq` is a `TabularMSA` with a</span>
        <span class=" -Color -Color-Red"># dtype that isn&#39;t a subclass of `GrammaredSequence`, this is</span>
        <span class=" -Color -Color-Red"># guaranteed by `TabularMSA`.</span>
        <span class=" -Color -Color-Green">if</span> <span class=" -Color -Color-Green">not</span> isinstance<span class=" -Color -Color-Blue">(</span>seq<span class=" -Color -Color-Blue">,</span> <span class=" -Color -Color-Blue">(</span>GrammaredSequence<span class=" -Color -Color-Blue">,</span> TabularMSA<span class=" -Color -Color-Blue">)):</span>
            <span class=" -Color -Color-Green">raise</span> TypeError<span class=" -Color -Color-Blue">(</span>
                <span class=" -Color -Color-Blue">&quot;`seq1` and `seq2` must be GrammaredSequence subclasses or &quot;</span>
                <span class=" -Color -Color-Blue">&quot;TabularMSA, not type %r&quot;</span> <span class=" -Color -Color-Blue">%</span> type<span class=" -Color -Color-Blue">(</span>seq<span class=" -Color -Color-Blue">).</span>__name__<span class=" -Color -Color-Blue">)</span>

    seq1 <span class=" -Color -Color-Blue">=</span> _coerce_alignment_input_type<span class=" -Color -Color-Blue">(</span>seq1<span class=" -Color -Color-Blue">)</span>
    seq2 <span class=" -Color -Color-Blue">=</span> _coerce_alignment_input_type<span class=" -Color -Color-Blue">(</span>seq2<span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Green">if</span> seq1<span class=" -Color -Color-Blue">.</span>dtype <span class=" -Color -Color-Green">is</span> <span class=" -Color -Color-Green">not</span> seq2<span class=" -Color -Color-Blue">.</span>dtype<span class=" -Color -Color-Blue">:</span>
        <span class=" -Color -Color-Green">raise</span> TypeError<span class=" -Color -Color-Blue">(</span>
            <span class=" -Color -Color-Blue">&quot;`seq1` and `seq2` must have the same dtype: %r != %r&quot;</span>
            <span class=" -Color -Color-Blue">%</span> <span class=" -Color -Color-Blue">(</span>seq1<span class=" -Color -Color-Blue">.</span>dtype<span class=" -Color -Color-Blue">.</span>__name__<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">.</span>dtype<span class=" -Color -Color-Blue">.</span>__name__<span class=" -Color -Color-Blue">))</span>

    <span class=" -Color -Color-Green">if</span> penalize_terminal_gaps<span class=" -Color -Color-Blue">:</span>
        init_matrices_f <span class=" -Color -Color-Blue">=</span> _init_matrices_nw
    <span class=" -Color -Color-Green">else</span><span class=" -Color -Color-Blue">:</span>
        init_matrices_f <span class=" -Color -Color-Blue">=</span> _init_matrices_nw_no_terminal_gap_penalty

    score_matrix<span class=" -Color -Color-Blue">,</span> traceback_matrix <span class=" -Color -Color-Blue">=</span> \
        _compute_score_and_traceback_matrices<span class=" -Color -Color-Blue">(</span>
            seq1<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">,</span> gap_open_penalty<span class=" -Color -Color-Blue">,</span> gap_extend_penalty<span class=" -Color -Color-Blue">,</span>
            substitution_matrix<span class=" -Color -Color-Blue">,</span> new_alignment_score<span class=" -Color -Color-Blue">=-</span>np<span class=" -Color -Color-Blue">.</span>inf<span class=" -Color -Color-Blue">,</span>
            init_matrices_f<span class=" -Color -Color-Blue">=</span>init_matrices_f<span class=" -Color -Color-Blue">,</span>
            penalize_terminal_gaps<span class=" -Color -Color-Blue">=</span>penalize_terminal_gaps<span class=" -Color -Color-Blue">)</span>

    end_row_position <span class=" -Color -Color-Blue">=</span> traceback_matrix<span class=" -Color -Color-Blue">.</span>shape<span class=" -Color -Color-Blue">[</span><span class=" -Color -Color-Cyan">0</span><span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">-</span> <span class=" -Color -Color-Cyan">1</span>
    end_col_position <span class=" -Color -Color-Blue">=</span> traceback_matrix<span class=" -Color -Color-Blue">.</span>shape<span class=" -Color -Color-Blue">[</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">]</span> <span class=" -Color -Color-Blue">-</span> <span class=" -Color -Color-Cyan">1</span>

    aligned1<span class=" -Color -Color-Blue">,</span> aligned2<span class=" -Color -Color-Blue">,</span> score<span class=" -Color -Color-Blue">,</span> seq1_start_position<span class=" -Color -Color-Blue">,</span> seq2_start_position <span class=" -Color -Color-Blue">=</span> \
        _traceback<span class=" -Color -Color-Blue">(</span>traceback_matrix<span class=" -Color -Color-Blue">,</span> score_matrix<span class=" -Color -Color-Blue">,</span> seq1<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">,</span>
                   end_row_position<span class=" -Color -Color-Blue">,</span> end_col_position<span class=" -Color -Color-Blue">)</span>
    start_end_positions <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">[(</span>seq1_start_position<span class=" -Color -Color-Blue">,</span> end_col_position<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">),</span>
                           <span class=" -Color -Color-Blue">(</span>seq2_start_position<span class=" -Color -Color-Blue">,</span> end_row_position<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">)]</span>

    msa <span class=" -Color -Color-Blue">=</span> TabularMSA<span class=" -Color -Color-Blue">(</span>aligned1 <span class=" -Color -Color-Blue">+</span> aligned2<span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Green">return</span> msa<span class=" -Color -Color-Blue">,</span> score<span class=" -Color -Color-Blue">,</span> start_end_positions
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aln</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">global_pairwise_align</span><span class="p">(</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;HEAGAWGHEE&quot;</span><span class="p">),</span> <span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;PAWHEAE&quot;</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">blosum50</span><span class="p">,</span> <span class="n">penalize_terminal_gaps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TabularMSA[Protein]
----------------------
Stats:
    sequence count: 2
    position count: 11
----------------------
HEAGAWGHE-E
-PA--W-HEAE
1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/share/miniconda/envs/iab2/lib/python3.8/site-packages/skbio/alignment/_pairwise.py:595: EfficiencyWarning: You&#39;re using skbio&#39;s python implementation of Needleman-Wunsch alignment. This is known to be very slow (e.g., thousands of times slower than a native C implementation). We&#39;ll be adding a faster version soon (see https://github.com/biocore/scikit-bio/issues/254 to track progress on this).
  warn(&quot;You&#39;re using skbio&#39;s python implementation of Needleman-Wunsch &quot;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-note-on-computing-f-and-t">
<h3>A note on computing <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span><a class="headerlink" href="#a-note-on-computing-f-and-t" title="Permalink to this headline">¶</a></h3>
<p>Some applications of global alignment use both the alignment score and the aligned sequences, and some only use one or the other. As a result, some applications optimize this process by only keeping track of the information they need. For example, if you’re working on a database search algorithm, you might only care about the score of the alignment. In this case you might not need to keep track of <span class="math notranslate nohighlight">\(T\)</span>, and could reduce the amount of memory that your software requires by not keeping track of it.</p>
</div>
</div>
<div class="section" id="global-versus-local-alignment">
<h2>Global versus local alignment<a class="headerlink" href="#global-versus-local-alignment" title="Permalink to this headline">¶</a></h2>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition-video admonition">
<p class="admonition-title">Video</p>
<p><a class="reference external" href="https://youtu.be/9e72ujGRio4">This video</a> on the QIIME 2 YouTube channel summarizes the content through the end of this chapter.</p>
</div>
</div>
<p>The alignment we just constructed is a <em>global alignment</em>, meaning we align both sequences from their beginning through their end. This has some important specific applications: for example, if we have two full-length protein sequences, and we have a crystal structure for one of them, we can use global alignment to give us a direct mapping between all positions in both sequences.</p>
<p>This is in contrast to local alignment, where we have a pair of sequences that we suspect may partially overlap each other, and we want to know what the best possible alignment of all or part of one sequence is with all or part of the other sequences. Perhaps the most widely used application of this is in sequence database searching (e.g., <a class="reference external" href="http://blast.ncbi.nlm.nih.gov/Blast.cgi">the BLAST web server</a>), where we have a query sequence and we want to find the closest match (or matches) in a reference database containing many different gene sequences. In this case, the whole reference database could be represented as a single sequence, as we could perform a local alignment against it to find the region that contains the highest scoring match.</p>
<p>Global and local alignment are both used for different applications. We’ll next look at an algorithm for computing local alignments. You’ll see that this is very similar to Needleman-Wunsch alignment.</p>
</div>
<div class="section" id="smith-waterman-local-sequence-alignment">
<h2>Smith-Waterman local sequence alignment<a class="headerlink" href="#smith-waterman-local-sequence-alignment" title="Permalink to this headline">¶</a></h2>
<p>The algorithm that is most commonly used for performing local alignment was originally published by Temple F. Smith and Michael S. Waterman (1981) <span id="id7">[<a class="reference internal" href="#id28">SW81</a>]</span>, and is therefore referred to as Smith-Waterman alignment. In terms of the resulting alignment, the difference between Smith-Waterman and Needleman-Wunsch is that the aligned sequences in Smith-Waterman can be a subsequence of one or both of the unaligned (input) sequences. In Needleman-Wunsch alignment, the aligned sequences will be full-length with respect to the unaligned sequences.</p>
<p>Algorithmically, Smith-Waterman is nearly identical to Needleman-Wunsch, with three small but important differences. We’ll now work through Smith-Waterman alignment following the same steps that we followed for Needleman-Wunsch, and look at the differences as we go. We’ll redefine our two sequences to align here. As you did for Needleman-Wunsch, after working through this example with these sequences, come back here and experiment with different sequences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio</span> <span class="kn">import</span> <span class="n">Protein</span>
<span class="n">seq1</span> <span class="o">=</span> <span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;HEAGAWGHEE&quot;</span><span class="p">)</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;PAWHEAE&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">seq1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seq2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HEAGAWGHEE
PAWHEAE
</pre></div>
</div>
</div>
</div>
<div class="section" id="id8">
<h3>Step 1: Create blank matrices.<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p><span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span> are created in the same way for Smith-Waterman as for Needleman-Wunsch so prior to initialization, <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span> would again look like the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/3818343713.py:3: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  F = np.zeros(shape=(num_rows, num_cols), dtype=np.int)
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">   </th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  A</th><th style="text-align: right;">  G</th><th style="text-align: right;">  A</th><th style="text-align: right;">  W</th><th style="text-align: right;">  G</th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  E</th></tr>
</thead>
<tbody>
<tr><td>  </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>P </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>W </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>H </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>E </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>E </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
</tbody>
</table></div></div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_T</span><span class="p">(</span><span class="n">h_sequence</span><span class="p">,</span> <span class="n">v_sequence</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">:</span>
        <span class="n">data_</span> <span class="o">=</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="n">translation_table</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;•&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;↖&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;↑&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;←&quot;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">data_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span>  <span class="n">translation_table</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">show_F</span><span class="p">(</span><span class="n">h_sequence</span><span class="p">,</span> <span class="n">v_sequence</span><span class="p">,</span> <span class="n">data_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
<span class="n">show_T</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/335952657.py:1: DeprecationWarning: `np.str` is a deprecated alias for the builtin `str`. To silence this warning, use `str` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.str_` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  T = np.full(shape=(num_rows, num_cols), fill_value=&quot; &quot;, dtype=np.str)
/tmp/ipykernel_3474/668998788.py:2: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  if data.dtype == np.int:
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>   </th><th>H  </th><th>E  </th><th>A  </th><th>G  </th><th>A  </th><th>W  </th><th>G  </th><th>H  </th><th>E  </th><th>E  </th></tr>
</thead>
<tbody>
<tr><td>  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>P </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>W </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>H </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>E </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>E </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
</tbody>
</table></div></div>
</div>
</div>
<div class="section" id="id9">
<h3>Step 2: Compute <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>.<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Computing <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span> is slightly different for Smith-Waterman than for Needleman-Wunsch. First, initialization is easier. The following formulas are used for computing the first row and column of <span class="math notranslate nohighlight">\(F\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
&amp; F(0, 0) = 0\\
&amp; F(i, 0) = 0\\
&amp; F(0, j) = 0
\end{align}
\end{split}\]</div>
<p>Initializing <span class="math notranslate nohighlight">\(F\)</span> would therefore result in the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">):</span>
    <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">):</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">   </th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  A</th><th style="text-align: right;">  G</th><th style="text-align: right;">  A</th><th style="text-align: right;">  W</th><th style="text-align: right;">  G</th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  E</th></tr>
</thead>
<tbody>
<tr><td>  </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>P </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>W </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>H </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>E </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>E </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
</tbody>
</table></div></div>
</div>
<p>Because none of the values that were just added to <span class="math notranslate nohighlight">\(F\)</span> depend on any other cells in <span class="math notranslate nohighlight">\(F\)</span>, initializing <span class="math notranslate nohighlight">\(T\)</span> would result in the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;•&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">):</span>
    <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;•&quot;</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">):</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;•&quot;</span>

<span class="n">show_T</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/668998788.py:2: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  if data.dtype == np.int:
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>   </th><th>H  </th><th>E  </th><th>A  </th><th>G  </th><th>A  </th><th>W  </th><th>G  </th><th>H  </th><th>E  </th><th>E  </th></tr>
</thead>
<tbody>
<tr><td>  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td></tr>
<tr><td>P </td><td>•  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>•  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>W </td><td>•  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>H </td><td>•  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>E </td><td>•  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>A </td><td>•  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
<tr><td>E </td><td>•  </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td><td>   </td></tr>
</tbody>
</table></div></div>
</div>
<p>We’d next want to compute the remaining cells in <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>. This proceeds exactly the same as for Needleman-Wunsch, except that there is one additional term in the scoring function:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F(i, j) = max \left(\begin{align}
&amp; 0\\
&amp; F(i-1, j-1) + s(c_i, c_j)\\
&amp; F(i-1, j) - d\\
&amp; F(i, j-1) - d)
\end{align}\right)
\end{split}\]</div>
<p>Go back to the final <span class="math notranslate nohighlight">\(F\)</span> matrix that you computed with Needleman-Wunsch earlier in the chapter. How would this new scoring term change that matrix? As you did before, compute the values for the first few cells of <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, this time using the Smith-Waterman scoring function. Remember that when you add a score to <span class="math notranslate nohighlight">\(F\)</span> that does not depend on other cells in <span class="math notranslate nohighlight">\(F\)</span> (which in this case corresponds to <span class="math notranslate nohighlight">\(0\)</span> being the max value from the scoring function), you should add a bullet (•) to the corresponding cell in <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>We’ll use the same function that we used above to compute the full <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span> matrices. To indicate that we now want to compute this using Smith-Waterman, we pass some additional parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio.alignment._pairwise</span> <span class="kn">import</span> <span class="n">_init_matrices_sw</span>
<span class="n">seq1</span> <span class="o">=</span> <span class="n">TabularMSA</span><span class="p">([</span><span class="n">seq1</span><span class="p">])</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">TabularMSA</span><span class="p">([</span><span class="n">seq2</span><span class="p">])</span>

<span class="n">sw_matrix</span><span class="p">,</span> <span class="n">traceback_matrix</span> <span class="o">=</span> <span class="n">_compute_score_and_traceback_matrices</span><span class="p">(</span>
    <span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">blosum50</span><span class="p">,</span> <span class="n">new_alignment_score</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">init_matrices_f</span><span class="o">=</span><span class="n">_init_matrices_sw</span><span class="p">)</span>

<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sw_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">   </th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  A</th><th style="text-align: right;">  G</th><th style="text-align: right;">  A</th><th style="text-align: right;">  W</th><th style="text-align: right;">  G</th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  E</th></tr>
</thead>
<tbody>
<tr><td>  </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>P </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  5</td><td style="text-align: right;">  0</td><td style="text-align: right;">  5</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>W </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  2</td><td style="text-align: right;">  0</td><td style="text-align: right;"> 20</td><td style="text-align: right;"> 12</td><td style="text-align: right;">  4</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td></tr>
<tr><td>H </td><td style="text-align: right;">  0</td><td style="text-align: right;"> 10</td><td style="text-align: right;">  2</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;"> 12</td><td style="text-align: right;"> 18</td><td style="text-align: right;"> 22</td><td style="text-align: right;"> 14</td><td style="text-align: right;">  6</td></tr>
<tr><td>E </td><td style="text-align: right;">  0</td><td style="text-align: right;">  2</td><td style="text-align: right;"> 16</td><td style="text-align: right;">  8</td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  4</td><td style="text-align: right;"> 10</td><td style="text-align: right;"> 18</td><td style="text-align: right;"> 28</td><td style="text-align: right;"> 20</td></tr>
<tr><td>A </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  8</td><td style="text-align: right;"> 21</td><td style="text-align: right;"> 13</td><td style="text-align: right;">  5</td><td style="text-align: right;">  0</td><td style="text-align: right;">  4</td><td style="text-align: right;"> 10</td><td style="text-align: right;"> 20</td><td style="text-align: right;"> 27</td></tr>
<tr><td>E </td><td style="text-align: right;">  0</td><td style="text-align: right;">  0</td><td style="text-align: right;">  6</td><td style="text-align: right;"> 13</td><td style="text-align: right;"> 18</td><td style="text-align: right;"> 12</td><td style="text-align: right;">  4</td><td style="text-align: right;">  0</td><td style="text-align: right;">  4</td><td style="text-align: right;"> 16</td><td style="text-align: right;"> 26</td></tr>
</tbody>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_T</span><span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">traceback_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/668998788.py:2: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  if data.dtype == np.int:
/tmp/ipykernel_3474/668998788.py:3: DeprecationWarning: `np.str` is a deprecated alias for the builtin `str`. To silence this warning, use `str` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.str_` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  data_ = T = np.full(shape=data.shape, fill_value=&quot; &quot;, dtype=np.str)
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>   </th><th>H  </th><th>E  </th><th>A  </th><th>G  </th><th>A  </th><th>W  </th><th>G  </th><th>H  </th><th>E  </th><th>E  </th></tr>
</thead>
<tbody>
<tr><td>  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td></tr>
<tr><td>P </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td></tr>
<tr><td>A </td><td>•  </td><td>•  </td><td>•  </td><td>↖  </td><td>•  </td><td>↖  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td></tr>
<tr><td>W </td><td>•  </td><td>•  </td><td>•  </td><td>•  </td><td>↖  </td><td>•  </td><td>↖  </td><td>←  </td><td>←  </td><td>•  </td><td>•  </td></tr>
<tr><td>H </td><td>•  </td><td>↖  </td><td>←  </td><td>•  </td><td>•  </td><td>•  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td><td>←  </td></tr>
<tr><td>E </td><td>•  </td><td>↑  </td><td>↖  </td><td>←  </td><td>•  </td><td>•  </td><td>↑  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td></tr>
<tr><td>A </td><td>•  </td><td>•  </td><td>↑  </td><td>↖  </td><td>←  </td><td>←  </td><td>•  </td><td>↖  </td><td>↑  </td><td>↑  </td><td>↖  </td></tr>
<tr><td>E </td><td>•  </td><td>•  </td><td>↖  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td><td>•  </td><td>↖  </td><td>↖  </td><td>↖  </td></tr>
</tbody>
</table></div></div>
</div>
</div>
<div class="section" id="id10">
<h3>Step 3: Transcribe the alignment.<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>There is one small difference in the traceback step between Smith-Waterman and Needleman-Wunsch. You should now begin tracing back from the cell with the highest value in <span class="math notranslate nohighlight">\(F\)</span>, rather than the bottom right cell of the matrix. We find this cell directly in the code below. As before, the alignment terminates when we hit a bullet (•) character, but in contrast to Needleman-Wunsch alignment, this can happen anywhere in the matrix, not only in <span class="math notranslate nohighlight">\(F(0, 0)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_value</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">max_i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_j</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sw_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sw_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">sw_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_value</span><span class="p">:</span>
            <span class="n">max_i</span><span class="p">,</span> <span class="n">max_j</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">sw_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

<span class="n">aln1</span><span class="p">,</span> <span class="n">aln2</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">start_a1</span><span class="p">,</span> <span class="n">start_a2</span> <span class="o">=</span> <span class="n">_traceback</span><span class="p">(</span><span class="n">traceback_matrix</span><span class="p">,</span> <span class="n">sw_matrix</span><span class="p">,</span> <span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">max_i</span><span class="p">,</span> <span class="n">max_j</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">aln1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">aln2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AWGHE
AW-HE
28.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="automating-smith-waterman-alignment-with-python">
<h3>Automating Smith-Waterman alignment with Python<a class="headerlink" href="#automating-smith-waterman-alignment-with-python" title="Permalink to this headline">¶</a></h3>
<p>Again, we can define a function, which will allow us to provide the required input and just get our aligned sequences back.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio.alignment</span> <span class="kn">import</span> <span class="n">local_pairwise_align</span>

<span class="o">%</span><span class="k">psource</span> local_pairwise_align
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">@</span>experimental<span class=" -Color -Color-Blue">(</span>as_of<span class=" -Color -Color-Blue">=&quot;0.4.0&quot;)</span>
<span class=" -Color -Color-Green">def</span> local_pairwise_align<span class=" -Color -Color-Blue">(</span>seq1<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">,</span> gap_open_penalty<span class=" -Color -Color-Blue">,</span>
                         gap_extend_penalty<span class=" -Color -Color-Blue">,</span> substitution_matrix<span class=" -Color -Color-Blue">):</span>
    <span class=" -Color -Color-Blue">&quot;&quot;&quot;Locally align exactly two seqs with Smith-Waterman</span>

<span class=" -Color -Color-Blue">    Parameters</span>
<span class=" -Color -Color-Blue">    ----------</span>
<span class=" -Color -Color-Blue">    seq1 : GrammaredSequence</span>
<span class=" -Color -Color-Blue">        The first unaligned sequence.</span>
<span class=" -Color -Color-Blue">    seq2 : GrammaredSequence</span>
<span class=" -Color -Color-Blue">        The second unaligned sequence.</span>
<span class=" -Color -Color-Blue">    gap_open_penalty : int or float</span>
<span class=" -Color -Color-Blue">        Penalty for opening a gap (this is substracted from previous best</span>
<span class=" -Color -Color-Blue">        alignment score, so is typically positive).</span>
<span class=" -Color -Color-Blue">    gap_extend_penalty : int or float</span>
<span class=" -Color -Color-Blue">        Penalty for extending a gap (this is substracted from previous best</span>
<span class=" -Color -Color-Blue">        alignment score, so is typically positive).</span>
<span class=" -Color -Color-Blue">    substitution_matrix: 2D dict (or similar)</span>
<span class=" -Color -Color-Blue">        Lookup for substitution scores (these values are added to the</span>
<span class=" -Color -Color-Blue">        previous best alignment score).</span>

<span class=" -Color -Color-Blue">    Returns</span>
<span class=" -Color -Color-Blue">    -------</span>
<span class=" -Color -Color-Blue">    tuple</span>
<span class=" -Color -Color-Blue">        ``TabularMSA`` object containing the aligned sequences, alignment score</span>
<span class=" -Color -Color-Blue">        (float), and start/end positions of each input sequence (iterable</span>
<span class=" -Color -Color-Blue">        of two-item tuples). Note that start/end positions are indexes into the</span>
<span class=" -Color -Color-Blue">        unaligned sequences.</span>

<span class=" -Color -Color-Blue">    See Also</span>
<span class=" -Color -Color-Blue">    --------</span>
<span class=" -Color -Color-Blue">    local_pairwise_align_protein</span>
<span class=" -Color -Color-Blue">    local_pairwise_align_nucleotide</span>
<span class=" -Color -Color-Blue">    skbio.alignment.local_pairwise_align_ssw</span>
<span class=" -Color -Color-Blue">    global_pairwise_align</span>
<span class=" -Color -Color-Blue">    global_pairwise_align_protein</span>
<span class=" -Color -Color-Blue">    global_pairwise_align_nucelotide</span>

<span class=" -Color -Color-Blue">    Notes</span>
<span class=" -Color -Color-Blue">    -----</span>
<span class=" -Color -Color-Blue">    This algorithm was originally described in [1]_. The scikit-bio</span>
<span class=" -Color -Color-Blue">    implementation was validated against the EMBOSS water web server [2]_.</span>

<span class=" -Color -Color-Blue">    References</span>
<span class=" -Color -Color-Blue">    ----------</span>
<span class=" -Color -Color-Blue">    .. [1] Identification of common molecular subsequences.</span>
<span class=" -Color -Color-Blue">       Smith TF, Waterman MS.</span>
<span class=" -Color -Color-Blue">       J Mol Biol. 1981 Mar 25;147(1):195-7.</span>
<span class=" -Color -Color-Blue">    .. [2] http://www.ebi.ac.uk/Tools/psa/emboss_water/</span>

<span class=" -Color -Color-Blue">    &quot;&quot;&quot;</span>
    warn<span class=" -Color -Color-Blue">(&quot;You&#39;re using skbio&#39;s python implementation of Smith-Waterman &quot;</span>
         <span class=" -Color -Color-Blue">&quot;alignment. This will be very slow (e.g., thousands of times slower) &quot;</span>
         <span class=" -Color -Color-Blue">&quot;than skbio.alignment.local_pairwise_align_ssw.&quot;,</span>
         EfficiencyWarning<span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Green">for</span> seq <span class=" -Color -Color-Green">in</span> seq1<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">:</span>
        <span class=" -Color -Color-Green">if</span> <span class=" -Color -Color-Green">not</span> isinstance<span class=" -Color -Color-Blue">(</span>seq<span class=" -Color -Color-Blue">,</span> GrammaredSequence<span class=" -Color -Color-Blue">):</span>
            <span class=" -Color -Color-Green">raise</span> TypeError<span class=" -Color -Color-Blue">(</span>
                <span class=" -Color -Color-Blue">&quot;`seq1` and `seq2` must be %r subclasses, not type %r&quot;</span> <span class=" -Color -Color-Blue">%</span>
                <span class=" -Color -Color-Blue">(</span>GrammaredSequence<span class=" -Color -Color-Blue">.</span>__name__<span class=" -Color -Color-Blue">,</span> type<span class=" -Color -Color-Blue">(</span>seq<span class=" -Color -Color-Blue">).</span>__name__<span class=" -Color -Color-Blue">))</span>

    <span class=" -Color -Color-Green">if</span> type<span class=" -Color -Color-Blue">(</span>seq1<span class=" -Color -Color-Blue">)</span> <span class=" -Color -Color-Green">is</span> <span class=" -Color -Color-Green">not</span> type<span class=" -Color -Color-Blue">(</span>seq2<span class=" -Color -Color-Blue">):</span>
        <span class=" -Color -Color-Green">raise</span> TypeError<span class=" -Color -Color-Blue">(</span>
            <span class=" -Color -Color-Blue">&quot;`seq1` and `seq2` must be the same type: %r != %r&quot;</span>
            <span class=" -Color -Color-Blue">%</span> <span class=" -Color -Color-Blue">(</span>type<span class=" -Color -Color-Blue">(</span>seq1<span class=" -Color -Color-Blue">).</span>__name__<span class=" -Color -Color-Blue">,</span> type<span class=" -Color -Color-Blue">(</span>seq2<span class=" -Color -Color-Blue">).</span>__name__<span class=" -Color -Color-Blue">))</span>

    seq1 <span class=" -Color -Color-Blue">=</span> _coerce_alignment_input_type<span class=" -Color -Color-Blue">(</span>seq1<span class=" -Color -Color-Blue">)</span>
    seq2 <span class=" -Color -Color-Blue">=</span> _coerce_alignment_input_type<span class=" -Color -Color-Blue">(</span>seq2<span class=" -Color -Color-Blue">)</span>

    score_matrix<span class=" -Color -Color-Blue">,</span> traceback_matrix <span class=" -Color -Color-Blue">=</span> _compute_score_and_traceback_matrices<span class=" -Color -Color-Blue">(</span>
        seq1<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">,</span> gap_open_penalty<span class=" -Color -Color-Blue">,</span> gap_extend_penalty<span class=" -Color -Color-Blue">,</span>
        substitution_matrix<span class=" -Color -Color-Blue">,</span> new_alignment_score<span class=" -Color -Color-Blue">=</span><span class=" -Color -Color-Cyan">0.0</span><span class=" -Color -Color-Blue">,</span>
        init_matrices_f<span class=" -Color -Color-Blue">=</span>_init_matrices_sw<span class=" -Color -Color-Blue">)</span>

    end_row_position<span class=" -Color -Color-Blue">,</span> end_col_position <span class=" -Color -Color-Blue">=</span>\
        np<span class=" -Color -Color-Blue">.</span>unravel_index<span class=" -Color -Color-Blue">(</span>np<span class=" -Color -Color-Blue">.</span>argmax<span class=" -Color -Color-Blue">(</span>score_matrix<span class=" -Color -Color-Blue">),</span> score_matrix<span class=" -Color -Color-Blue">.</span>shape<span class=" -Color -Color-Blue">)</span>

    aligned1<span class=" -Color -Color-Blue">,</span> aligned2<span class=" -Color -Color-Blue">,</span> score<span class=" -Color -Color-Blue">,</span> seq1_start_position<span class=" -Color -Color-Blue">,</span> seq2_start_position <span class=" -Color -Color-Blue">=</span> \
        _traceback<span class=" -Color -Color-Blue">(</span>traceback_matrix<span class=" -Color -Color-Blue">,</span> score_matrix<span class=" -Color -Color-Blue">,</span> seq1<span class=" -Color -Color-Blue">,</span> seq2<span class=" -Color -Color-Blue">,</span>
                   end_row_position<span class=" -Color -Color-Blue">,</span> end_col_position<span class=" -Color -Color-Blue">)</span>
    start_end_positions <span class=" -Color -Color-Blue">=</span> <span class=" -Color -Color-Blue">[(</span>seq1_start_position<span class=" -Color -Color-Blue">,</span> end_col_position<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">),</span>
                           <span class=" -Color -Color-Blue">(</span>seq2_start_position<span class=" -Color -Color-Blue">,</span> end_row_position<span class=" -Color -Color-Blue">-</span><span class=" -Color -Color-Cyan">1</span><span class=" -Color -Color-Blue">)]</span>

    msa <span class=" -Color -Color-Blue">=</span> TabularMSA<span class=" -Color -Color-Blue">(</span>aligned1 <span class=" -Color -Color-Blue">+</span> aligned2<span class=" -Color -Color-Blue">)</span>

    <span class=" -Color -Color-Green">return</span> msa<span class=" -Color -Color-Blue">,</span> score<span class=" -Color -Color-Blue">,</span> start_end_positions
</pre></div>
</div>
</div>
</div>
<p>And we can take the function one step further, and wrap <code class="docutils literal notranslate"><span class="pre">local_pairwise_align</span></code> and <code class="docutils literal notranslate"><span class="pre">global_pairwise_align</span></code> up in a more general <code class="docutils literal notranslate"><span class="pre">align</span></code> function, which takes a boolean parameter (i.e., <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>) indicating where we want a local or global alignment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="n">sequence1</span><span class="p">,</span> <span class="n">sequence2</span><span class="p">,</span> <span class="n">gap_penalty</span><span class="p">,</span> <span class="n">substitution_matrix</span><span class="p">,</span> <span class="n">local</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">local</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">local_pairwise_align</span><span class="p">(</span><span class="n">sequence1</span><span class="p">,</span> <span class="n">sequence2</span><span class="p">,</span> <span class="n">gap_penalty</span><span class="p">,</span> <span class="n">gap_penalty</span><span class="p">,</span> <span class="n">substitution_matrix</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">global_pairwise_align</span><span class="p">(</span><span class="n">sequence1</span><span class="p">,</span> <span class="n">sequence2</span><span class="p">,</span> <span class="n">gap_penalty</span><span class="p">,</span> <span class="n">gap_penalty</span><span class="p">,</span> <span class="n">substitution_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aln</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">align</span><span class="p">(</span><span class="n">Protein</span><span class="p">(</span><span class="s1">&#39;HEAGAWGHEE&#39;</span><span class="p">),</span> <span class="n">Protein</span><span class="p">(</span><span class="s1">&#39;PAWHEAE&#39;</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="n">blosum50</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TabularMSA[Protein]
---------------------
Stats:
    sequence count: 2
    position count: 5
---------------------
AWGHE
AW-HE
28.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/share/miniconda/envs/iab2/lib/python3.8/site-packages/skbio/alignment/_pairwise.py:318: EfficiencyWarning: You&#39;re using skbio&#39;s python implementation of Smith-Waterman alignment. This will be very slow (e.g., thousands of times slower) than skbio.alignment.local_pairwise_align_ssw.
  warn(&quot;You&#39;re using skbio&#39;s python implementation of Smith-Waterman &quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aln</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">align</span><span class="p">(</span><span class="n">Protein</span><span class="p">(</span><span class="s1">&#39;HEAGAWGHEE&#39;</span><span class="p">),</span> <span class="n">Protein</span><span class="p">(</span><span class="s1">&#39;PAWHEAE&#39;</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="n">blosum50</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TabularMSA[Protein]
----------------------
Stats:
    sequence count: 2
    position count: 11
----------------------
HEAGAWGHEE-
---PAW-HEAE
25.0
</pre></div>
</div>
</div>
</div>
<p>This was a lot of complicated material, so congratulations on making it this far. If you feel comfortable with everything we just went through, you now understand the basics of pairwise alignment, which is easily the most fundamental algorithm in bioinformatics. If you’re not feeling totally comfortable with all of this, go back and re-read it. This time spend more time working out the individual steps with a pencil and paper by computing more cells in <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span> as you go, and performing the traceback step manually. And don’t get discouraged: we can describe the steps that need to be carried out to a computer with just a few lines of code, so it’s nothing magical. Computing a pairwise alignment just involves the systematic application of a few well defined steps. You <em>will</em> be able to carry out those steps (a metric of your understanding of the algorithm) as long as you put a bit of effort into performing those steps.</p>
</div>
</div>
<div class="section" id="differential-scoring-of-gaps">
<h2>Differential scoring of gaps<a class="headerlink" href="#differential-scoring-of-gaps" title="Permalink to this headline">¶</a></h2>
<p>The second limitation of the our simple alignment algorithm (which we discussed way back at the beginning of this chapter, and one that is also present in the versions of Needleman-Wunsch and Smith-Waterman implemented above, is that all gaps are scored equally whether they represent the opening of a new insertion/deletion, or the extension of an existing insertion/deletion. This isn’t ideal based on what we know about how insertion/deletion events occur (see <a class="reference external" href="http://www.ncbi.nlm.nih.gov/books/NBK21114/">this discussion of replication slippage</a> <span id="id11">[<a class="reference internal" href="#id29">Bro02</a>]</span> if you’re not familiar with the biological process that is thought to lead to small insertions as deletions). Instead, we might want to incur a large penalty for opening a gap, but a smaller penalty for extending an existing gap. This is referred to as <em>affine gap scoring</em>.</p>
<p>To score gap extensions differently from gap creations (or gap opens), we need to modify the terms corresponding to the addition of gaps in our scoring function. When we compute the score corresponding to a gap in our alignment (i.e., where we’d insert either a ↑ or a ← in <span class="math notranslate nohighlight">\(T\)</span>), we should incur a <em>gap extension penalty</em> if the value in <span class="math notranslate nohighlight">\(T\)</span> that the new arrow will point to is the same type of arrow. Otherwise, we should incur the <em>gap open penalty</em>. If we represent our gap open penalty as <span class="math notranslate nohighlight">\(d^0\)</span>, and our gap extend penalty as <span class="math notranslate nohighlight">\(d^e\)</span>, our scoring scheme would look now like the following:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F(i, j) = max \left(\begin{align}
&amp; 0\\
&amp; F(i-1, j-1) + s(c_i, c_j)\\
&amp; \left\{\begin{array}{l l} F(i-1, j) - d^e \quad \text{if $T(i-1, j)$ is ↑}\\ F(i-1, j) - d^o \quad \text{if $T(i-1, j)$ is not ↑} \end{array}  \right\} \\
&amp; \left\{\begin{array}{l l} F(i, j-1) - d^e \quad \text{if $T(i, j-1)$ is ←}\\ F(i, j-1) - d^o \quad \text{if $T(i, j-1)$ is not ←} \end{array}  \right\}
 \end{align}\right)
\end{split}\]</div>
<p>Notice how we only use the gap extend penalty if the previous max score resulted from a gap in the same sequence because it represents the continuation of an existing gap in that sequence. We know which sequence a gap is being introduced in by the characters in the traceback matrix: ↑ always implies a gap in the sequence on the horizontal axis of <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, and ← always implies a gap in the sequence on the vertical axis of <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>And here’s a quick quiz: is this a Smith-Waterman or Needleman-Wunsch scoring function? How do you know?</p>
<p>Take a look at how the scores differ with these additions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seq1</span> <span class="o">=</span> <span class="n">TabularMSA</span><span class="p">([</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;HEAGAWGHEE&quot;</span><span class="p">)])</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">TabularMSA</span><span class="p">([</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;PAWHEAE&quot;</span><span class="p">)])</span>

<span class="n">sw_matrix</span><span class="p">,</span> <span class="n">traceback_matrix</span> <span class="o">=</span> <span class="n">_compute_score_and_traceback_matrices</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">blosum50</span><span class="p">)</span>

<span class="n">show_F</span><span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sw_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th style="text-align: right;">   </th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  A</th><th style="text-align: right;">  G</th><th style="text-align: right;">  A</th><th style="text-align: right;">  W</th><th style="text-align: right;">  G</th><th style="text-align: right;">  H</th><th style="text-align: right;">  E</th><th style="text-align: right;">  E</th></tr>
</thead>
<tbody>
<tr><td>  </td><td style="text-align: right;">  0</td><td style="text-align: right;"> -8</td><td style="text-align: right;"> -9</td><td style="text-align: right;">-10</td><td style="text-align: right;">-11</td><td style="text-align: right;">-12</td><td style="text-align: right;">-13</td><td style="text-align: right;">-14</td><td style="text-align: right;">-15</td><td style="text-align: right;">-16</td><td style="text-align: right;">-17</td></tr>
<tr><td>P </td><td style="text-align: right;"> -8</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -9</td><td style="text-align: right;">-10</td><td style="text-align: right;">-12</td><td style="text-align: right;">-12</td><td style="text-align: right;">-16</td><td style="text-align: right;">-15</td><td style="text-align: right;">-16</td><td style="text-align: right;">-16</td><td style="text-align: right;">-17</td></tr>
<tr><td>A </td><td style="text-align: right;"> -9</td><td style="text-align: right;">-10</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;">-10</td><td style="text-align: right;"> -7</td><td style="text-align: right;">-15</td><td style="text-align: right;">-16</td><td style="text-align: right;">-17</td><td style="text-align: right;">-17</td><td style="text-align: right;">-17</td></tr>
<tr><td>W </td><td style="text-align: right;">-10</td><td style="text-align: right;">-12</td><td style="text-align: right;">-11</td><td style="text-align: right;"> -6</td><td style="text-align: right;"> -7</td><td style="text-align: right;">-13</td><td style="text-align: right;">  8</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td></tr>
<tr><td>H </td><td style="text-align: right;">-11</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -8</td><td style="text-align: right;"> -9</td><td style="text-align: right;"> -8</td><td style="text-align: right;"> -9</td><td style="text-align: right;">  0</td><td style="text-align: right;">  6</td><td style="text-align: right;"> 10</td><td style="text-align: right;">  2</td><td style="text-align: right;">  1</td></tr>
<tr><td>E </td><td style="text-align: right;">-12</td><td style="text-align: right;"> -8</td><td style="text-align: right;">  6</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> -3</td><td style="text-align: right;"> -4</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  6</td><td style="text-align: right;"> 16</td><td style="text-align: right;">  8</td></tr>
<tr><td>A </td><td style="text-align: right;">-13</td><td style="text-align: right;"> -9</td><td style="text-align: right;"> -2</td><td style="text-align: right;"> 11</td><td style="text-align: right;">  3</td><td style="text-align: right;">  2</td><td style="text-align: right;">  1</td><td style="text-align: right;">  0</td><td style="text-align: right;"> -1</td><td style="text-align: right;">  8</td><td style="text-align: right;"> 15</td></tr>
<tr><td>E </td><td style="text-align: right;">-14</td><td style="text-align: right;">-10</td><td style="text-align: right;"> -3</td><td style="text-align: right;">  3</td><td style="text-align: right;">  8</td><td style="text-align: right;">  2</td><td style="text-align: right;"> -1</td><td style="text-align: right;"> -2</td><td style="text-align: right;">  0</td><td style="text-align: right;">  7</td><td style="text-align: right;"> 14</td></tr>
</tbody>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_T</span><span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">traceback_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3474/668998788.py:2: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  if data.dtype == np.int:
/tmp/ipykernel_3474/668998788.py:3: DeprecationWarning: `np.str` is a deprecated alias for the builtin `str`. To silence this warning, use `str` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.str_` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  data_ = T = np.full(shape=data.shape, fill_value=&quot; &quot;, dtype=np.str)
</pre></div>
</div>
<div class="output text_html"><table>
<thead>
<tr><th>  </th><th>   </th><th>H  </th><th>E  </th><th>A  </th><th>G  </th><th>A  </th><th>W  </th><th>G  </th><th>H  </th><th>E  </th><th>E  </th></tr>
</thead>
<tbody>
<tr><td>  </td><td>•  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td></tr>
<tr><td>P </td><td>↑  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td></tr>
<tr><td>A </td><td>↑  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>←  </td><td>←  </td><td>←  </td><td>↖  </td><td>↖  </td></tr>
<tr><td>W </td><td>↑  </td><td>↖  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td></tr>
<tr><td>H </td><td>↑  </td><td>↖  </td><td>←  </td><td>←  </td><td>↖  </td><td>↖  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td><td>←  </td></tr>
<tr><td>E </td><td>↑  </td><td>↑  </td><td>↖  </td><td>←  </td><td>←  </td><td>←  </td><td>↑  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>←  </td></tr>
<tr><td>A </td><td>↑  </td><td>↑  </td><td>↑  </td><td>↖  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>←  </td><td>↑  </td><td>↖  </td></tr>
<tr><td>E </td><td>↑  </td><td>↑  </td><td>↖  </td><td>↑  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↖  </td><td>↑  </td><td>↖  </td></tr>
</tbody>
</table></div></div>
</div>
<p>While we just looked at Smith-Waterman alignment with affine gap scoring, Needleman-Wunsch is adapted in the same way for affine gap scoring.</p>
<p>The functions we worked with above all take <code class="docutils literal notranslate"><span class="pre">gap_open_penalty</span></code> and <code class="docutils literal notranslate"><span class="pre">gap_extend_penalty</span></code>, which we can see by calling <code class="docutils literal notranslate"><span class="pre">help</span></code> on the function. So, we can use those functions to explore sequence alignment with affine gap scoring.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">global_pairwise_align</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on function global_pairwise_align in module skbio.alignment._pairwise:

global_pairwise_align(seq1, seq2, gap_open_penalty, gap_extend_penalty, substitution_matrix, penalize_terminal_gaps=False)
    Globally align a pair of seqs or alignments with Needleman-Wunsch
    
    State: Experimental as of 0.4.0.
    
    Parameters
    ----------
    seq1 : GrammaredSequence or TabularMSA
        The first unaligned sequence(s).
    seq2 : GrammaredSequence or TabularMSA
        The second unaligned sequence(s).
    gap_open_penalty : int or float
        Penalty for opening a gap (this is substracted from previous best
        alignment score, so is typically positive).
    gap_extend_penalty : int or float
        Penalty for extending a gap (this is substracted from previous best
        alignment score, so is typically positive).
    substitution_matrix: 2D dict (or similar)
        Lookup for substitution scores (these values are added to the
        previous best alignment score).
    penalize_terminal_gaps: bool, optional
        If True, will continue to penalize gaps even after one sequence has
        been aligned through its end. This behavior is true Needleman-Wunsch
        alignment, but results in (biologically irrelevant) artifacts when
        the sequences being aligned are of different length. This is ``False``
        by default, which is very likely to be the behavior you want in all or
        nearly all cases.
    
    Returns
    -------
    tuple
        ``TabularMSA`` object containing the aligned sequences, alignment score
        (float), and start/end positions of each input sequence (iterable
        of two-item tuples). Note that start/end positions are indexes into the
        unaligned sequences.
    
    See Also
    --------
    local_pairwise_align
    local_pairwise_align_protein
    local_pairwise_align_nucleotide
    skbio.alignment.local_pairwise_align_ssw
    global_pairwise_align_protein
    global_pairwise_align_nucelotide
    
    Notes
    -----
    This algorithm (in a slightly more basic form) was originally described
    in [1]_. The scikit-bio implementation was validated against the
    EMBOSS needle web server [2]_.
    
    This function can be use to align either a pair of sequences, a pair of
    alignments, or a sequence and an alignment.
    
    References
    ----------
    .. [1] A general method applicable to the search for similarities in
       the amino acid sequence of two proteins.
       Needleman SB, Wunsch CD.
       J Mol Biol. 1970 Mar;48(3):443-53.
    .. [2] http://www.ebi.ac.uk/Tools/psa/emboss_needle/
</pre></div>
</div>
</div>
</div>
<p>Here I define <code class="docutils literal notranslate"><span class="pre">seq1</span></code> to be slightly different than what I have above. Notice how we get different alignments when we use affine gap penalties (i.e., <code class="docutils literal notranslate"><span class="pre">gap_extend_penalty</span></code> is not equal to <code class="docutils literal notranslate"><span class="pre">gap_open_penalty</span></code>) versus equal gap open and gap extend penalties.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seq1</span> <span class="o">=</span> <span class="n">TabularMSA</span><span class="p">([</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;HEAGAWGFHEE&quot;</span><span class="p">)])</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">TabularMSA</span><span class="p">([</span><span class="n">Protein</span><span class="p">(</span><span class="s2">&quot;PAWHEAE&quot;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aln</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">global_pairwise_align</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">blosum50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TabularMSA[Protein]
----------------------
Stats:
    sequence count: 2
    position count: 14
----------------------
---HEAGAWGFHEE
PAWHEAE-------
18.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aln</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">global_pairwise_align</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">blosum50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TabularMSA[Protein]
----------------------
Stats:
    sequence count: 2
    position count: 12
----------------------
HEAGAWGFHEE-
---PAW--HEAE
24.0
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>As a final exercise in this section, try to adapt the commands above to compute local alignments with affine gap scoring. You won’t need to write any code to do this, but rather you can adapt some of the commands that we’ve already used above. Don’t forget about the <code class="docutils literal notranslate"><span class="pre">help()</span></code> function - that’s essential for learning how to use a function.</p>
</div>
</div>
<div class="section" id="how-long-does-pairwise-sequence-alignment-take">
<h2>How long does pairwise sequence alignment take?<a class="headerlink" href="#how-long-does-pairwise-sequence-alignment-take" title="Permalink to this headline">¶</a></h2>
<p>Two of the practical considerations we need to think about when developing algorithms and applications is how long they’ll take to run, and how much system memory (or RAM) they’ll require. Both of these can be limiting factors for applications that require sequence alignments, so a lot of effort is spent understanding how to optimize sequence alignment.</p>
<p>We just worked through a few algorithms for pairwise sequence alignment, and ran some toy examples based on short sequences. What if we wanted to scale this up to align much longer sequences, or to align relatively short sequences against a large database? In this section we’ll explore the runtime of sequence alignment.</p>
<div class="section" id="comparing-implementations-of-smith-waterman">
<h3>Comparing implementations of Smith-Waterman<a class="headerlink" href="#comparing-implementations-of-smith-waterman" title="Permalink to this headline">¶</a></h3>
<p>To explore runtime, let’s use the IPython <a class="reference external" href="http://ipython.org/ipython-doc/dev/interactive/tutorial.html#magic-functions">magic function</a> called <code class="docutils literal notranslate"><span class="pre">timeit</span></code>. This allows us to conveniently run a given command many times and reports the average time it takes to run. We’ll use this to see how long local alignment takes to run. Note that we don’t care about getting the actual alignment back for the moment. We just want the runtime in seconds.</p>
<p>First, let’s <em>benchmark</em> the runtime of the scikit-bio <code class="docutils literal notranslate"><span class="pre">local_pairwise_align_nucleotide</span></code> function. This specifically performs nucleotide alignment, and is implemented in Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio.alignment</span> <span class="kn">import</span> <span class="n">local_pairwise_align_nucleotide</span>

<span class="n">seq1</span> <span class="o">=</span> <span class="n">DNA</span><span class="p">(</span><span class="s2">&quot;GGTCTTCGCTAGGCTTTCATCGGGTTCGGCATCTACTCTGAGTTACTACG&quot;</span><span class="p">)</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">DNA</span><span class="p">(</span><span class="s2">&quot;GGTCTTCAGGCTTTCATCGGGAACGGCATCTCTGAGTTACTACC&quot;</span><span class="p">)</span>

<span class="o">%</span><span class="k">timeit</span> local_pairwise_align_nucleotide(seq1, seq2, gap_open_penalty=8, gap_extend_penalty=1)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>71.9 ms ± 154 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
</div>
</div>
<p>From interpreting these results, it looks like this is taking a few seconds to compute the alignment. When executing this, you may see a red warning box pop up. Read that warning message (a good practice, in general!). This is telling us that there is a faster implementation of Smith-Waterman alignment available in scikit-bio, so let’s benchmark that one for comparison. We’ll use the same two sequences for a direct comparison, of course.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skbio.alignment</span> <span class="kn">import</span> <span class="n">local_pairwise_align_ssw</span>

<span class="o">%</span><span class="k">timeit</span> local_pairwise_align_ssw(seq1, seq2)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>278 µs ± 2.08 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
</div>
</div>
<p>We clearly see here that the <code class="docutils literal notranslate"><span class="pre">local_pairwise_align_ssw</span></code> function is much faster for performing alignment than <code class="docutils literal notranslate"><span class="pre">local_pairwise_align_nucleotide</span></code> (be sure to compare the units of each run time!). This is because <code class="docutils literal notranslate"><span class="pre">local_pairwise_align_ssw</span></code> is a much more efficient implementation of Smith-Waterman alignment, and it additionally applies some cool tricks that allow it to not compute all of the values in <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, but still get the right answer most of the time. This is referred to as a <em>heuristic</em> approach to optimizing an algorithm. We’ll spend some time defining and comparing heuristics in the Database Searching chapter, but to get you to start thinking about it, what you care about is how much a heuristic reduces the run time of an algorithm, and how often it gives you the same answer as the full algorithm. Take a minute to compare the results of the two functions we just ran:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msa</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">local_pairwise_align_nucleotide</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">,</span> <span class="n">gap_open_penalty</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">gap_extend_penalty</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">msa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TabularMSA[DNA]
-------------------------------------------------
Stats:
    sequence count: 2
    position count: 49
-------------------------------------------------
GGTCTTCGCTAGGCTTTCATCGGGTTCGGCATCTACTCTGAGTTACTAC
GGTCTTC---AGGCTTTCATCGGGAACGGCATCT---CTGAGTTACTAC
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msa</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">local_pairwise_align_ssw</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">)</span>
<span class="n">msa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TabularMSA[DNA]
-------------------------------------------------
Stats:
    sequence count: 2
    position count: 49
-------------------------------------------------
GGTCTTCGCTAGGCTTTCATCGGGTTCGGCATCTACTCTGAGTTACTAC
GGTCTTC---AGGCTTTCATCGGGAACGGCAT---CTCTGAGTTACTAC
</pre></div>
</div>
</div>
</div>
<p>How do the results look?</p>
<p>If you were truly evaluating a new heuristic, you’d want to compare many different inputs with the heuristic and the full algorithm.  For now, just take it from me that <code class="docutils literal notranslate"><span class="pre">local_pairwise_align_ssw</span></code> is generally producing comparable results to <code class="docutils literal notranslate"><span class="pre">local_pairwise_align_nucleotide</span></code>, and you can clearly see that it’s running much faster. So, we’ll use that implementation in this text when we need to perform fast local alignments.</p>
</div>
<div class="section" id="analyzing-smith-waterman-run-time-as-a-function-of-sequence-length">
<h3>Analyzing Smith-Waterman run time as a function of sequence length<a class="headerlink" href="#analyzing-smith-waterman-run-time-as-a-function-of-sequence-length" title="Permalink to this headline">¶</a></h3>
<p>Next, let’s apply this to pairs of sequences where we vary the length. We don’t really care what the sequences are here, so we’ll use <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/routines.random.html">numpy’s <code class="docutils literal notranslate"><span class="pre">random</span></code> module</a> to get random pairs of sequences.</p>
<p>Let’s first define a function to generate a random sequence of a specific length and type of biological sequence. Take a minute to understand that code, as we’ll do this a few times throughout the text.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">random_sequence</span><span class="p">(</span><span class="n">moltype</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Our &quot;alphabet&quot; here will consist of the standard characters in a</span>
    <span class="c1"># molecules alphabet.</span>
    <span class="n">alphabet</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">moltype</span><span class="o">.</span><span class="n">nondegenerate_chars</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">alphabet</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">moltype</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s apply that function a few times. Execute this cell a few times to confirm that the sequences we get back are in fact changing each time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">random_sequence</span><span class="p">(</span><span class="n">DNA</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_sequence</span><span class="p">(</span><span class="n">DNA</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_sequence</span><span class="p">(</span><span class="n">DNA</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_sequence</span><span class="p">(</span><span class="n">DNA</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GAGTTATTTG
GCGATGATAT
CTAATCAGTGGTAGCTTTAGTCTGG
AGCCCAGTCATTGACCCACGATACGTCCCAATCTGGGTACTGAATACTGG
</pre></div>
</div>
</div>
</div>
<p>Now we’ll define a loop where we align random pairs of sequences of increasing length, and compile the time it took to align the sequences. Here we want programmatic access to the runtimes, so we’re going to use <a class="reference external" href="https://docs.python.org/3/library/timeit.html">Python’s <code class="docutils literal notranslate"><span class="pre">timeit</span></code> module</a> (which the <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> magic function is based on). The computer’s doing a lot of work here, even though these are relatively small sequences, so this may take over a minute or so.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>

<span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">seq_lengths</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span><span class="mi">110000</span><span class="p">,</span><span class="mi">20000</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_time_function</span><span class="p">(</span><span class="n">seq_length</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
        <span class="n">seq1</span> <span class="o">=</span> <span class="n">random_sequence</span><span class="p">(</span><span class="n">DNA</span><span class="p">,</span> <span class="n">seq_length</span><span class="p">)</span>
        <span class="n">seq2</span> <span class="o">=</span> <span class="n">random_sequence</span><span class="p">(</span><span class="n">DNA</span><span class="p">,</span> <span class="n">seq_length</span><span class="p">)</span>
        <span class="n">local_pairwise_align_ssw</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>

<span class="k">for</span> <span class="n">seq_length</span> <span class="ow">in</span> <span class="n">seq_lengths</span><span class="p">:</span>
    <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">get_time_function</span><span class="p">(</span><span class="n">seq_length</span><span class="p">))</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeat</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">3</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done!
</pre></div>
</div>
</div>
</div>
<p>If we look at the run times, we can see that they are increasing with increasing sequence lengths:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">runtimes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">seq_lengths</span><span class="p">,</span> <span class="n">times</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sequence length&quot;</span><span class="p">,</span> <span class="s2">&quot;Runtime (s)&quot;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">runtimes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sequence length</th>
      <th>Runtime (s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5000.0</td>
      <td>0.330899</td>
    </tr>
    <tr>
      <th>1</th>
      <td>25000.0</td>
      <td>1.815241</td>
    </tr>
    <tr>
      <th>2</th>
      <td>45000.0</td>
      <td>3.632817</td>
    </tr>
    <tr>
      <th>3</th>
      <td>65000.0</td>
      <td>5.564674</td>
    </tr>
    <tr>
      <th>4</th>
      <td>85000.0</td>
      <td>7.789289</td>
    </tr>
    <tr>
      <th>5</th>
      <td>105000.0</td>
      <td>10.335369</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>That’s probably to be expected, but what we care about now is <em>how</em> the runtimes are increasing as a function of sequence length. Is the relationship between runtime and sequence length:</p>
<ul class="simple">
<li><p>linear: <span class="math notranslate nohighlight">\(runtime \approx constant \times sequence\ length\)</span></p></li>
<li><p>quadratic: <span class="math notranslate nohighlight">\(runtime \approx constant \times {sequence\ length}^2\)</span></p></li>
<li><p>exponential: <span class="math notranslate nohighlight">\(runtime \approx {constant}^{sequence\ length}\)</span></p></li>
<li><p>or something else?</p></li>
</ul>
<p>Ultimately, we’d like to get an idea of how useful alignment would be in practice if our sequences were much longer, and specifically if sequence length might ultimately make sequence alignment too slow. Plotting these runtimes can help us to figure this out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Sequence length&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Runtime (s)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">runtimes</span><span class="p">,</span> <span class="n">fit_reg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Sequence length&#39;, ylabel=&#39;Runtime (s)&#39;&gt;
</pre></div>
</div>
<img alt="_images/pairwise-alignment_98_1.png" src="_images/pairwise-alignment_98_1.png" />
</div>
</div>
<p>This looks to be a <a class="reference external" href="http://en.wikipedia.org/wiki/Quadratic_time">quadratic relationship</a>: the increase in runtime is proportional to the square of sequence length. If you think back to the computation of <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, this makes sense. If our sequences are each five bases long, our matrices will have five rows and five columns, so <span class="math notranslate nohighlight">\(5 \times 5 = 25\)</span> cells that need to be filled in by performing some numeric computations. If we double our sequences lengths to ten, our matrices will have ten rows and ten columns, so <span class="math notranslate nohighlight">\(10 \times 10 = 100\)</span> cells that need to be filled in. Because each of the numeric computations take roughly the same amount of time (you can take that on faith, or prove it to yourself using <code class="docutils literal notranslate"><span class="pre">timeit</span></code>), when we double our sequence length we have four times as many cells to compute.</p>
<p>When runtime scales quadratically, that can be a practical limitation for an algorithm. We’d much prefer to see a linear relationship (i.e., if we double our sequence length, our runtime doubles). But this is an inherent issue with pairwise alignment, so it’s one that we need to deal with.</p>
<p>One question you might have is whether developing a version of this algorithm which can run in parallel on multiple processors would be an effective way to make it scale to larger data sets. In the next cell, we look and how the plot would change if we could run the alignment process over four processors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if we could split this process over more processors (four, for example)</span>
<span class="c1"># that would effectively reduce the runtime by 1/4</span>
<span class="n">parallel_runtimes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">seq_lengths</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span><span class="o">/</span><span class="mi">4</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sequence length&quot;</span><span class="p">,</span> <span class="s2">&quot;Runtime (s)&quot;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">parallel_runtimes</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Sequence length&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Runtime (s)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parallel_runtimes</span><span class="p">,</span> <span class="n">fit_reg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Sequence length&#39;, ylabel=&#39;Runtime (s)&#39;&gt;
</pre></div>
</div>
<img alt="_images/pairwise-alignment_100_1.png" src="_images/pairwise-alignment_100_1.png" />
</div>
</div>
<p>Notice that the runtimes in the plot are smaller, but shape of the curve is the same. While parallelization can reduce the runtime of an algorithm, it won’t change its <em>computational complexity</em> (or how its runtime scales as a function of its input size). You can explore the computational complexity of different types of algorithms in the <a class="reference external" href="http://bigocheatsheet.com/">Big-O Cheat Sheet</a>, though it’s a fairly advanced introduction to the topic (and one that’s usually covered in the second or third year for Computer Science majors).</p>
</div>
<div class="section" id="conclusions-on-the-scalability-of-pairwise-sequence-alignment-with-smith-waterman">
<h3>Conclusions on the scalability of pairwise sequence alignment with Smith-Waterman<a class="headerlink" href="#conclusions-on-the-scalability-of-pairwise-sequence-alignment-with-smith-waterman" title="Permalink to this headline">¶</a></h3>
<p>These are pretty long sequences that we’re working with here, and the runtime is still pretty reasonable (only a few seconds for DNA sequences around 100,000 bases), so that suggests this implementation of Smith-Waterman should work ok for aligning pairs of sequences, even if the sequences are fairly long. However, we’re often interested in doing more than just pairwise alignment. For example, we may want to align many sequences to each other (which we’ll explore in the Multiple Sequence Alignment chapter), or we may want to perform many pairwise alignments (which we’ll explore in the Database Searching chapter). In the next chapter we’ll begin exploring ways to address this scalability issue by approximating solutions to the problem.</p>
</div>
</div>
<div class="section" id="list-of-works-cited">
<h2>List of works cited<a class="headerlink" href="#list-of-works-cited" title="Permalink to this headline">¶</a></h2>
<p id="id12"><dl class="citation">
<dt class="label" id="id22"><span class="brackets"><a class="fn-backref" href="#id1">AGM+90</a></span></dt>
<dd><p>S F Altschul, W Gish, W Miller, E W Myers, and D J Lipman. Basic local alignment search tool. <em>J. Mol. Biol.</em>, 215(3):403–410, October 1990.</p>
</dd>
<dt class="label" id="id29"><span class="brackets"><a class="fn-backref" href="#id11">Bro02</a></span></dt>
<dd><p>Terence A Brown. <em>Mutation, Repair and Recombination</em>. Wiley-Liss, 2002.</p>
</dd>
<dt class="label" id="id27"><span class="brackets"><a class="fn-backref" href="#id6">Dur98</a></span></dt>
<dd><p>Richard Durbin. <em>Biological Sequence Analysis (Probabilistic Models of Proteins and Nucleic Acids)</em>. Cambridge University Press, 1 edition, April 1998.</p>
</dd>
<dt class="label" id="id25"><span class="brackets"><a class="fn-backref" href="#id4">Edd04</a></span></dt>
<dd><p>Sean R Eddy. Where did the BLOSUM62 alignment score matrix come from? <em>Nat. Biotechnol.</em>, 22(8):1035–1036, August 2004.</p>
</dd>
<dt class="label" id="id24"><span class="brackets"><a class="fn-backref" href="#id3">HH92</a></span></dt>
<dd><p>S Henikoff and J G Henikoff. Amino acid substitution matrices from protein blocks. <em>Proc. Natl. Acad. Sci. U. S. A.</em>, 89(22):10915–10919, November 1992.</p>
</dd>
<dt class="label" id="id23"><span class="brackets"><a class="fn-backref" href="#id2">MOD78</a></span></dt>
<dd><p>R M Schwartz M. O. Dayhoff. Chapter 22: a model of evolutionary change in proteins. In <em>in Atlas of Protein Sequence and Structure</em>. 1978.</p>
</dd>
<dt class="label" id="id26"><span class="brackets"><a class="fn-backref" href="#id5">NW70</a></span></dt>
<dd><p>S B Needleman and C D Wunsch. A general method applicable to the search for similarities in the amino acid sequence of two proteins. <em>J. Mol. Biol.</em>, 48(3):443–453, March 1970.</p>
</dd>
<dt class="label" id="id28"><span class="brackets"><a class="fn-backref" href="#id7">SW81</a></span></dt>
<dd><p>T F Smith and M S Waterman. Identification of common molecular subsequences. <em>J. Mol. Biol.</em>, 147(1):195–197, March 1981.</p>
</dd>
</dl>
</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="biological-information.html" title="previous page">Biological Information</a>
    <a class='right-next' id="next-link" href="database-searching.html" title="next page">Sequence homology searching</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By J Gregory Caporaso<br/>
        
            &copy; Copyright 2014-2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>